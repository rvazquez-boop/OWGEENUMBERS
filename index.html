<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel de Control ‚Äî Revenue Team üè¥‚Äç‚ò†Ô∏è</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800;900&family=Permanent+Marker&family=Bangers&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
:root{--bg:#d4f1f9;--bg2:#e8f8ff;--bg3:#c4e8f5;--bgi:#b8dff0;--brd:#7ec8e3;--brg:#4aa8c7;--txt:#0a2e4d;--dim:#3a6d8c;--mut:#6898b3;--pink:#e84393;--cyan:#0077b6;--purp:#6c5ce7;--org:#e17055;--grn:#00b894;--red:#d63031;--yel:#fdcb6e;--blue:#0984e3;--gold:#d4a017;--sand:#f4d5a6;--grad:linear-gradient(135deg,#74b9ff 0%,#0984e3 50%,#0077b6 100%);--gcard:linear-gradient(145deg,#e8f8ff 0%,#d4f1f9 100%);--ghead:linear-gradient(135deg,#0077b6 0%,#0096c7 40%,#00b4d8 100%);}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Nunito',sans-serif;background:var(--bg);color:var(--txt);min-height:100vh;
background-image:linear-gradient(180deg,#87ceeb 0%,#b8e4f8 15%,#d4f1f9 35%,#e8f8ff 60%,#f4d5a6 92%,#e6c38c 100%);
background-attachment:fixed;}
body::before{content:'';position:fixed;top:0;left:0;right:0;bottom:0;pointer-events:none;z-index:0;
background:
url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60' opacity='0.08'%3E%3Ctext x='30' y='35' text-anchor='middle' font-size='20'%3E%E2%9A%93%3C/text%3E%3C/svg%3E") repeat,
url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' opacity='0.06'%3E%3Ctext x='50' y='55' text-anchor='middle' font-size='28'%3E%F0%9F%90%99%3C/text%3E%3C/svg%3E") repeat;
}
body::after{content:'üêö ü¶Ä ‚≠ê üêö ü¶û ‚≠ê üêö ü¶Ä ‚≠ê üêö ü¶û ‚≠ê üêö ü¶Ä ‚≠ê';position:fixed;bottom:0;left:0;right:0;text-align:center;font-size:22px;letter-spacing:20px;padding:10px 0 6px;z-index:2;pointer-events:none;
background:linear-gradient(0deg,#e6c38c 0%,#f4d5a6 40%,transparent 100%);line-height:1;}
body>*{position:relative;z-index:1;}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
@keyframes wave{0%{background-position:0 0}100%{background-position:200px 0}}
@keyframes sparkle{0%,100%{opacity:.3}50%{opacity:1}}
@keyframes swim{0%{transform:translateX(-100px) scaleX(1)}49%{transform:translateX(calc(100vw + 100px)) scaleX(1)}50%{transform:translateX(calc(100vw + 100px)) scaleX(-1)}100%{transform:translateX(-100px) scaleX(-1)}}
.login-overlay{position:fixed;inset:0;background:linear-gradient(180deg,#87ceeb 0%,#b8e4f8 30%,#d4f1f9 60%,#f4d5a6 95%,#e6c38c 100%);z-index:9999;display:flex;align-items:center;justify-content:center;overflow:hidden;}.login-overlay.hidden{display:none;}
.login-overlay::before{content:'üêô ü¶à üê† üè¥‚Äç‚ò†Ô∏è ‚öì ü¶ë üêö üåä ü¶Ä üê°';position:absolute;bottom:50px;left:0;font-size:50px;letter-spacing:30px;animation:swim 25s linear infinite;white-space:nowrap;opacity:.7;}
.login-overlay::after{content:'üêö ü¶Ä ‚≠ê üêö ü¶û ‚≠ê üêö ü¶Ä ‚≠ê üêö ü¶û ‚≠ê üêö';position:absolute;bottom:0;left:0;right:0;text-align:center;font-size:28px;letter-spacing:15px;padding:15px 0 8px;background:linear-gradient(0deg,#e6c38c 0%,#f4d5a6 50%,transparent 100%);}
.login-box{background:rgba(255,255,255,.85);border:3px solid var(--gold);border-radius:20px;padding:48px 40px;text-align:center;max-width:440px;width:90%;box-shadow:0 8px 40px rgba(0,119,182,.25);backdrop-filter:blur(10px);}
.login-box h1{font-family:'Fredoka One',cursive;font-size:24px;font-weight:400;color:#0077b6;letter-spacing:2px;margin-bottom:8px;}
.login-box .sub{font-size:13px;color:#3a6d8c;margin-bottom:28px;line-height:1.6;}
.login-box input{width:100%;padding:14px 18px;border:2px solid #7ec8e3;border-radius:12px;background:rgba(135,206,235,.2);color:#0a2e4d;font-size:14px;font-family:'Nunito',sans-serif;margin-bottom:12px;text-align:center;}
.login-box input:focus{border-color:#0077b6;outline:none;box-shadow:0 0 20px rgba(0,119,182,.3);}.login-box input::placeholder{color:#6898b3;}
.login-box .btn-login{width:100%;padding:14px;border:none;border-radius:12px;background:linear-gradient(135deg,#0077b6,#00b4d8,#48cae4);color:white;font-weight:700;font-size:16px;cursor:pointer;text-transform:uppercase;letter-spacing:2px;font-family:'Fredoka One',cursive;}
.login-box .btn-login:hover{box-shadow:0 4px 20px rgba(0,180,216,.5);transform:translateY(-2px);}.login-box .err{color:var(--red);font-size:11px;margin-top:8px;min-height:16px;}.login-box .logo{font-size:70px;margin-bottom:12px;animation:float 3s ease-in-out infinite;}
.header{background:linear-gradient(135deg,#0077b6 0%,#0096c7 30%,#00b4d8 60%,#48cae4 100%);padding:14px 36px 10px;position:sticky;top:0;z-index:100;border-bottom:3px solid var(--gold);box-shadow:0 4px 20px rgba(0,119,182,.3);overflow:hidden;}.header::after{content:'üè¥‚Äç‚ò†Ô∏è';position:absolute;right:200px;top:4px;font-size:26px;animation:float 4s ease-in-out infinite;opacity:.7;}.header-top{display:flex;justify-content:space-between;align-items:center;}
.header h1{font-family:'Fredoka One',cursive;font-size:20px;font-weight:400;color:#fff;letter-spacing:2px;-webkit-text-fill-color:unset;text-shadow:2px 2px 4px rgba(0,0,0,.2);}.header-sub{font-size:10px;color:rgba(255,255,255,.8);margin-top:2px;font-style:italic;}
.header-right{display:flex;align-items:center;gap:12px;}.header-badge{background:rgba(255,255,255,.2);border:1px solid rgba(255,255,255,.3);padding:4px 12px;border-radius:20px;font-size:10px;color:#fff;font-weight:600;}
.user-badge{background:rgba(255,255,255,.25);border:1px solid rgba(255,255,255,.4);padding:4px 14px;border-radius:20px;font-size:10px;color:#fff;font-weight:700;cursor:pointer;}.user-badge:hover{background:rgba(255,255,255,.35);}
.tab-bar{background:linear-gradient(90deg,#0096c7,#00b4d8,#0096c7);border-bottom:2px solid var(--brg);padding:0 36px;position:sticky;top:52px;z-index:99;display:flex;align-items:stretch;box-shadow:0 2px 10px rgba(0,0,0,.15);}
.tab{padding:12px 24px;font-family:'Fredoka One',cursive;font-size:13px;font-weight:400;letter-spacing:1.5px;text-transform:uppercase;cursor:pointer;border-bottom:3px solid transparent;color:rgba(255,255,255,.6);transition:all .25s;}.tab:hover{color:rgba(255,255,255,.85);background:rgba(255,255,255,.05);}
.tab.active{color:#fff;border-bottom-color:#fff;}.tab.active.t-inbound{color:#fff;border-bottom-color:#ffd740;}.tab.active.t-outbound{color:#fff;border-bottom-color:#ff9100;}.tab.active.t-ae{color:#fff;border-bottom-color:#ffc107;}.tab.active.t-general{color:#fff;border-bottom-color:#fff;}
.tab-controls{margin-left:auto;display:flex;align-items:center;gap:10px;padding:6px 0;}
.month-select{padding:5px 12px;border:1px solid var(--brg);border-radius:8px;font-size:11px;font-weight:600;color:var(--cyan);background:var(--bgi);cursor:pointer;font-family:'Orbitron',monospace;}.month-select:focus{border-color:var(--pink);outline:none;}.month-select option{background:var(--bg2);color:var(--txt);}
.btn{border:none;padding:6px 14px;border-radius:8px;font-size:9px;font-weight:700;cursor:pointer;text-transform:uppercase;letter-spacing:1px;transition:all .25s;font-family:'Inter',sans-serif;}
.btn-save{background:linear-gradient(135deg,#0077b6,#00b4d8);color:white;border:1px solid #48cae4;}.btn-save:hover{box-shadow:0 0 12px rgba(0,180,216,.4);transform:translateY(-1px);}
.btn-export{background:rgba(255,255,255,.3);color:#0077b6;border:1px solid #7ec8e3;}.btn-export:hover{background:rgba(255,255,255,.5);}
.btn-report{background:rgba(255,255,255,.3);color:#00b894;border:1px solid #55efc4;}.btn-report:hover{background:rgba(255,255,255,.5);}
.tab-page{display:none;}.tab-page.active{display:block;}.container{max-width:1500px;margin:0 auto;padding:16px 36px;}
.subtab-bar{display:flex;gap:0;background:rgba(255,255,255,.5);border-radius:12px;padding:4px;margin-bottom:18px;overflow-x:auto;border:1px solid var(--brd);}
.subtab{padding:10px 20px;font-family:'Fredoka One',cursive;font-size:12px;font-weight:400;letter-spacing:1px;text-transform:uppercase;cursor:pointer;border-radius:8px;color:var(--mut);transition:all .2s;white-space:nowrap;}.subtab:hover{color:var(--txt);background:rgba(0,119,182,.08);}.subtab.active{background:rgba(0,119,182,.15);color:var(--cyan);box-shadow:0 0 8px rgba(0,119,182,.15);}
.summary-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-bottom:20px;}
.s-card{background:rgba(255,255,255,.7);border:1px solid var(--brd);border-radius:12px;padding:14px 16px;position:relative;overflow:hidden;transition:border-color .3s,box-shadow .3s;backdrop-filter:blur(5px);}.s-card:hover{border-color:var(--cyan);box-shadow:0 2px 15px rgba(0,119,182,.15);}
.s-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--grad);opacity:.8;}.s-card.ok::before{background:var(--grn);opacity:1;}.s-card.alert::before{background:var(--red);opacity:1;}
.s-card .label{font-size:8px;text-transform:uppercase;letter-spacing:1.2px;color:var(--mut);font-weight:700;}.s-card .value{font-family:'Fredoka One',cursive;font-size:20px;font-weight:400;margin-top:3px;color:#0077b6;-webkit-text-fill-color:unset;}
.s-card .value.empty{-webkit-text-fill-color:var(--mut);background:none;}.s-card .sub{font-size:9px;color:var(--dim);margin-top:2px;}.s-card .delta{font-size:11px;font-weight:700;margin-top:3px;}
.delta-pos{color:var(--grn)!important;}.delta-warn{color:var(--org)!important;}.delta-neg{color:var(--red)!important;}.delta-none{color:var(--mut)!important;}
.section{background:rgba(255,255,255,.6);border:1px solid var(--brd);border-radius:12px;margin-bottom:14px;overflow:hidden;transition:border-color .3s;backdrop-filter:blur(5px);}.section:hover{border-color:rgba(0,119,182,.4);}
.sec-head{padding:10px 18px;display:flex;align-items:center;gap:8px;cursor:pointer;user-select:none;transition:background .2s;border-bottom:1px solid transparent;}.sec-head:hover{background:rgba(0,229,255,.03);}.sec-head.expanded{border-bottom:1px solid var(--brd);}
.sec-head .icon{font-size:18px;}.sec-head .title{font-family:'Fredoka One',cursive;font-size:13px;font-weight:400;text-transform:uppercase;letter-spacing:1.5px;}
.sec-head.blue .title{color:var(--cyan);}.sec-head.red .title{color:var(--red);}.sec-head.purple .title{color:var(--cyan);}.sec-head.green .title{color:var(--grn);}.sec-head.orange .title{color:var(--org);}.sec-head.yellow .title{color:var(--yel);}.sec-head.cyan .title{color:var(--cyan);}
.sec-head .toggle{margin-left:auto;color:var(--mut);font-size:13px;transition:transform .3s;}.sec-head .toggle.open{transform:rotate(180deg);}.sec-body{display:none;}.sec-body.open{display:block;}
.ktable{width:100%;border-collapse:collapse;}.ktable th,.ktable td{padding:8px 14px;text-align:right;font-size:12px;border-bottom:1px solid rgba(42,42,94,.5);}.ktable th:first-child,.ktable td:first-child{text-align:left;min-width:180px;font-weight:600;}.ktable th:nth-child(2),.ktable td:nth-child(2){text-align:center;min-width:90px;font-size:9px;text-transform:uppercase;letter-spacing:.5px;}
.r-magic{background:rgba(178,75,243,.05);}.r-magic td:first-child{color:var(--purp);}.r-magic td:nth-child(2){color:var(--mut);}.r-magic td:nth-child(3){color:var(--txt);font-family:'Orbitron',monospace;font-size:11px;}
.r-real{background:rgba(255,110,199,.06);}.r-real td:nth-child(2){color:var(--pink);font-weight:700;}
.r-real input{width:95px;padding:5px 7px;border:2px solid var(--brd);border-radius:8px;text-align:center;margin:0 auto;display:block;font-size:12px;font-weight:700;color:#0077b6;background:rgba(255,255,255,.6);font-family:'Nunito',sans-serif;transition:border-color .2s,box-shadow .2s;}.r-real input:focus{border-color:#0077b6;box-shadow:0 0 12px rgba(0,119,182,.25);outline:none;}.r-real input::placeholder{color:var(--mut);font-family:'Nunito',sans-serif;font-size:9px;font-weight:400;}
.r-var{background:rgba(0,0,0,.15);}.r-var td{font-size:11px;color:var(--dim);}.r-auto{background:rgba(0,255,247,.03);}.r-auto td{font-size:11px;}.r-auto td:nth-child(2){color:var(--cyan);}.r-auto td:nth-child(3){font-family:'Orbitron',monospace;font-size:10px;}
.sep td{height:4px;border:none;background:transparent;padding:0;}
.card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;padding:14px 18px;}
.p-card{background:rgba(255,255,255,.5);border:1px solid var(--brd);border-radius:10px;padding:12px;}.p-card.inactive{opacity:.4;border-style:dashed;}
.p-card .p-name{font-family:'Fredoka One',cursive;font-size:12px;font-weight:400;color:#0077b6;letter-spacing:1px;margin-bottom:6px;display:flex;justify-content:space-between;align-items:center;}
.p-card .p-name .tag{font-size:7px;padding:2px 6px;border-radius:4px;background:rgba(255,82,82,.2);color:var(--red);font-weight:600;letter-spacing:.5px;}.p-card .p-name .tag.ok{background:rgba(0,230,118,.15);color:var(--grn);}
.p-stat{display:flex;justify-content:space-between;margin-bottom:4px;font-size:10px;}.p-stat .lbl{color:var(--dim);}.p-stat .val{color:#0077b6;font-weight:700;font-family:'Nunito',sans-serif;font-size:10px;}
.team-footer{padding:8px 18px;display:flex;gap:18px;border-top:1px solid var(--brd);font-size:10px;color:var(--dim);flex-wrap:wrap;}.team-footer span{color:var(--cyan);font-weight:700;}
.dev-summary{padding:18px;display:grid;grid-template-columns:1fr 1fr;gap:16px;}.dev-block{background:rgba(255,255,255,.4);border:1px solid var(--brd);border-radius:12px;padding:14px;}.dev-block h4{font-family:'Fredoka One',cursive;font-size:11px;font-weight:400;text-transform:uppercase;letter-spacing:1px;color:#e84393;margin-bottom:10px;}
.dev-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:7px;}.dev-row .lbl{font-size:10px;color:var(--dim);flex:1;}.dev-row .pct{font-family:'Orbitron',monospace;font-size:11px;font-weight:700;width:60px;text-align:right;}.dev-row .eur{font-size:9px;width:80px;text-align:right;color:var(--dim);}
.dev-bar{flex:0 0 70px;height:6px;background:rgba(255,255,255,.05);border-radius:4px;margin:0 8px;overflow:hidden;}.dev-bar-fill{height:100%;border-radius:4px;transition:width .4s;}.dev-bar-fill.pos{background:linear-gradient(90deg,var(--grn),var(--cyan));}.dev-bar-fill.neg{background:linear-gradient(90deg,var(--red),var(--pink));}
.dev-total{margin-top:10px;padding-top:10px;border-top:1px solid var(--brd);display:flex;justify-content:space-between;align-items:center;}.dev-total .lbl{font-size:11px;font-weight:700;color:var(--txt);}.dev-total .val{font-family:'Orbitron',monospace;font-size:14px;font-weight:900;}
.hero-metrics{margin-bottom:22px;}
.hero-card{background:rgba(255,255,255,.85);border-radius:16px;padding:22px 26px;position:relative;overflow:hidden;backdrop-filter:blur(8px);transition:transform .2s,box-shadow .2s;border:2px solid var(--brd);}
.hero-card:hover{transform:translateY(-3px);box-shadow:0 8px 30px rgba(0,119,182,.2);}
.hero-card::before{content:'';position:absolute;top:0;left:0;right:0;height:5px;}
.hero-card.ok::before{background:var(--grn);}.hero-card.alert::before{background:var(--red);}.hero-card.neutral::before{background:var(--grad);}
.hero-card .hero-label{font-size:10px;text-transform:uppercase;letter-spacing:2px;color:var(--mut);font-weight:800;margin-bottom:4px;}
.hero-card .hero-value{font-family:'Fredoka One',cursive;font-weight:400;color:#0077b6;line-height:1.1;}
.hero-card .hero-obj{font-size:11px;color:var(--dim);margin-top:6px;}
.hero-card .hero-obj span{font-weight:700;}
.hero-card .hero-delta{font-weight:800;margin-top:6px;display:inline-block;padding:3px 10px;border-radius:6px;font-size:13px;}
.hero-card .hero-delta.delta-pos{color:var(--grn);background:rgba(0,184,148,.1);}.hero-card .hero-delta.delta-warn{color:var(--org);background:rgba(225,112,85,.1);}.hero-card .hero-delta.delta-neg{color:var(--red);background:rgba(214,48,49,.1);}.hero-card .hero-delta.delta-none{color:var(--mut);background:rgba(0,0,0,.04);}
.hero-card .hero-icon{position:absolute;right:20px;top:50%;transform:translateY(-50%);font-size:48px;opacity:.15;}
.hero-mrr{border-color:var(--gold);box-shadow:0 4px 24px rgba(212,160,23,.15);}
.hero-mrr .hero-value{font-size:42px;color:var(--gold);}
.hero-mrr .hero-icon{font-size:64px;opacity:.12;}
.hero-secondary .hero-value{font-size:30px;}
.hero-row{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:14px;}
.no-data-msg{text-align:center;padding:30px;color:var(--mut);font-style:italic;font-size:11px;}
.sit-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;padding:16px 18px;}
.sit-card{background:rgba(255,255,255,.5);border:1px solid var(--brd);border-radius:12px;padding:16px;position:relative;overflow:hidden;}.sit-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;}
.sit-card.sit-ok::before{background:var(--grn);}.sit-card.sit-warn::before{background:var(--org);}.sit-card.sit-bad::before{background:var(--red);}.sit-card.sit-na::before{background:var(--mut);}
.sit-card .sit-q{font-size:10px;color:var(--dim);font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px;}.sit-card .sit-answer{font-family:'Fredoka One',cursive;font-size:22px;font-weight:400;margin-bottom:4px;letter-spacing:1px;}
.sit-card .sit-detail{font-size:10px;color:var(--dim);line-height:1.6;}.sit-card .sit-detail b{color:var(--txt);font-weight:600;}
.sit-general{background:rgba(255,255,255,.4);border:1px solid var(--brd);border-radius:12px;padding:18px;margin:0 18px 18px;font-size:11px;line-height:1.8;color:var(--dim);}.sit-general .sit-title{font-family:'Fredoka One',cursive;font-size:14px;font-weight:400;color:#0077b6;margin-bottom:10px;letter-spacing:1.5px;}
.team-banner{display:flex;align-items:center;gap:24px;padding:24px;justify-content:center;background:rgba(255,255,255,.5);border:2px solid var(--brd);border-radius:16px;margin-bottom:16px;position:relative;overflow:hidden;}.team-banner::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,transparent,#0077b6,var(--gold),#0077b6,transparent);}.team-banner .crest img{width:130px;height:auto;filter:drop-shadow(0 0 15px rgba(0,119,182,.3));animation:float 4s ease-in-out infinite;}.team-banner .team-info{text-align:left;}
.team-banner .team-name{font-family:'Fredoka One',cursive;font-size:24px;font-weight:400;letter-spacing:2px;}.team-banner .team-stats{font-size:11px;color:var(--dim);margin-top:6px;line-height:1.6;}.team-banner .team-stats span{color:var(--cyan);font-weight:700;}
.tab-logo{display:flex;align-items:center;gap:16px;padding:12px 0;margin-bottom:12px;}.tab-logo img{width:80px;height:80px;object-fit:contain;filter:drop-shadow(0 0 15px rgba(255,255,255,.2));}
.tab-logo .tab-title{font-family:'Orbitron',monospace;font-size:18px;font-weight:900;letter-spacing:2px;}
.toast{position:fixed;bottom:50px;right:20px;background:linear-gradient(135deg,#0077b6,#00b4d8);color:white;padding:12px 24px;border-radius:12px;font-weight:700;font-size:13px;box-shadow:0 4px 20px rgba(0,119,182,.3);border:2px solid #48cae4;transform:translateY(100px);opacity:0;transition:all .35s;z-index:1000;font-family:'Fredoka One',cursive;letter-spacing:1px;}.toast.show{transform:translateY(0);opacity:1;}
@media(max-width:900px){.container{padding:12px;}.tab-bar{padding:0 12px;overflow-x:auto;}.tab{padding:10px 14px;font-size:9px;white-space:nowrap;}.summary-grid{grid-template-columns:repeat(2,1fr);}.dev-summary{grid-template-columns:1fr;}.card-grid{grid-template-columns:repeat(2,1fr);}.sit-grid{grid-template-columns:1fr;}}

/* Sem√°foro por equipo */
.semaforo-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px;margin-bottom:20px;}
.semaforo-card{background:rgba(255,255,255,.6);border:1px solid var(--brd);border-radius:14px;padding:18px;display:flex;align-items:center;gap:16px;transition:border-color .3s,box-shadow .3s;}
.semaforo-card:hover{box-shadow:0 2px 15px rgba(0,119,182,.15);}
.semaforo-card .sem-light{width:28px;height:28px;border-radius:50%;flex-shrink:0;box-shadow:0 0 16px currentColor;}
.semaforo-card .sem-light.sem-green{background:var(--grn);color:var(--grn);}
.semaforo-card .sem-light.sem-yellow{background:var(--yel);color:var(--yel);}
.semaforo-card .sem-light.sem-red{background:var(--red);color:var(--red);}
.semaforo-card .sem-light.sem-gray{background:var(--mut);color:var(--mut);}
.semaforo-card .sem-info{flex:1;}
.semaforo-card .sem-team{font-family:'Orbitron',monospace;font-size:10px;font-weight:700;letter-spacing:1px;}
.semaforo-card .sem-pct{font-family:'Orbitron',monospace;font-size:18px;font-weight:900;margin-top:2px;}
.semaforo-card .sem-detail{font-size:9px;color:var(--dim);margin-top:3px;}
.semaforo-card img{width:44px;height:auto;filter:drop-shadow(0 0 8px rgba(178,75,243,.3));}

/* Team Activity Comparison */
.team-act-card{background:var(--gcard);border:1px solid var(--brd);border-radius:14px;padding:20px;display:flex;align-items:center;gap:20px;margin-bottom:14px;}
.team-act-card .act-icon{font-size:32px;flex-shrink:0;}
.team-act-card .act-data{flex:1;display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;}
.team-act-card .act-col{text-align:center;}
.team-act-card .act-label{font-size:8px;text-transform:uppercase;letter-spacing:1px;color:var(--mut);font-weight:600;margin-bottom:4px;}
.team-act-card .act-value{font-family:'Orbitron',monospace;font-size:22px;font-weight:900;}
.team-act-card .act-value.hist{color:var(--dim);}
.team-act-card .act-value.curr{color:var(--cyan);}
.team-act-card .act-bar{height:8px;background:rgba(255,255,255,.05);border-radius:4px;margin-top:6px;overflow:hidden;position:relative;}
.team-act-card .act-bar-fill{height:100%;border-radius:4px;transition:width .5s;}
.team-act-card .act-bar-fill.above{background:linear-gradient(90deg,var(--grn),var(--cyan));}
.team-act-card .act-bar-fill.below{background:linear-gradient(90deg,var(--red),var(--pink));}
.team-act-card .act-delta{font-family:'Orbitron',monospace;font-size:14px;font-weight:700;margin-top:4px;}
.team-act-card .act-hint{font-size:9px;color:var(--dim);margin-top:2px;}

/* View Toggle Controls */
.view-toggle{
  display:flex;
  gap:8px;
  margin-left:auto;
  align-items:center;
}
.view-btn{
  padding:8px 16px;
  border:1px solid var(--brd);
  background:var(--bg3);
  color:var(--txt);
  border-radius:8px;
  cursor:pointer;
  font-size:13px;
  font-weight:500;
  transition:all 0.2s ease;
}
.view-btn:hover{
  border-color:var(--brg);
  background:var(--bgi);
}
.view-btn.active{
  background:var(--brg);
  border-color:var(--pink);
  color:var(--txt);
  box-shadow:0 0 20px rgba(178,75,243,0.5);
}

/* Pace & Projection Cards */
.pace-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:16px;
  margin-bottom:20px;
}
.pace-card{
  background:linear-gradient(145deg,var(--bg3),var(--bgi));
  border:1px solid var(--brd);
  border-radius:12px;
  padding:16px;
  overflow:hidden;
}
.pace-card .title{
  font-size:13px;
  font-weight:600;
  color:var(--pink);
  margin-bottom:8px;
  text-transform:uppercase;
  letter-spacing:0.5px;
}
.pace-card .status-line{
  font-size:12px;
  color:var(--dim);
  margin-bottom:12px;
  line-height:1.4;
}
.pace-bar{
  height:8px;
  background:var(--bg);
  border-radius:4px;
  overflow:hidden;
  margin-bottom:10px;
  border:1px solid var(--brd);
}
.pace-fill{
  height:100%;
  border-radius:4px;
  transition:width 0.3s ease;
}
.pace-fill.ahead{
  background:linear-gradient(90deg,var(--grn),var(--cyan));
}
.pace-fill.onpace{
  background:linear-gradient(90deg,var(--yel),var(--org));
}
.pace-fill.behind{
  background:linear-gradient(90deg,var(--org),var(--red));
}
.pace-stats{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
  font-size:12px;
}
.pace-stat{
  display:flex;
  justify-content:space-between;
  padding:6px 8px;
  background:rgba(0,0,0,0.3);
  border-radius:6px;
  color:var(--dim);
}
.pace-stat .label{
  font-weight:500;
}
.pace-stat .value{
  color:var(--txt);
  font-weight:600;
}

/* Projection specific */
.proj-line{
  display:flex;
  justify-content:space-between;
  padding:8px 0;
  font-size:12px;
  border-bottom:1px solid var(--brd);
}
.proj-line:last-child{
  border-bottom:none;
}
.proj-label{
  color:var(--dim);
}
.proj-value{
  color:var(--txt);
  font-weight:600;
}
/* MySpace 2000s floating decorations */
.sea-deco{position:fixed;pointer-events:none;z-index:0;font-size:45px;opacity:.35;animation:float 6s ease-in-out infinite;}
.sea-deco:nth-child(1){top:15%;left:3%;animation-delay:0s;font-size:55px;}
.sea-deco:nth-child(2){top:40%;right:2%;animation-delay:1.5s;font-size:40px;}
.sea-deco:nth-child(3){bottom:20%;left:5%;animation-delay:3s;font-size:50px;}
.sea-deco:nth-child(4){top:70%;right:4%;animation-delay:0.8s;font-size:42px;}
.sea-deco:nth-child(5){top:25%;right:8%;animation-delay:2.2s;font-size:36px;}
.sea-deco:nth-child(6){bottom:35%;left:2%;animation-delay:4s;font-size:48px;}
.sea-swimmer{position:fixed;bottom:70px;left:0;z-index:0;pointer-events:none;font-size:55px;animation:swim 40s linear infinite;opacity:.35;}
.sea-swimmer:nth-child(8){bottom:140px;font-size:40px;animation-duration:55s;animation-delay:10s;}
.tab-logo .tab-title{font-family:'Fredoka One',cursive!important;}
.month-select{background:rgba(255,255,255,.4)!important;border-color:var(--brd)!important;color:#0077b6!important;}
.month-select option{background:#e8f8ff!important;color:#0a2e4d!important;}
.view-btn{background:rgba(255,255,255,.3)!important;color:#0a2e4d!important;border-color:var(--brd)!important;}
.view-btn.active{background:#0077b6!important;color:#fff!important;border-color:#0077b6!important;box-shadow:0 2px 10px rgba(0,119,182,.3)!important;}
.pace-card{background:rgba(255,255,255,.5)!important;border-color:var(--brd)!important;}
.pace-card .title{color:#0077b6!important;}
.pace-stat{background:rgba(0,119,182,.06)!important;color:var(--dim)!important;}
.pace-stat .value{color:#0a2e4d!important;}
.team-act-card{background:rgba(255,255,255,.5)!important;border-color:var(--brd)!important;}
.team-act-card .act-value.hist{color:var(--dim)!important;}
.team-act-card .act-value.curr{color:#0077b6!important;}
.r-magic{background:rgba(0,119,182,.06)!important;}
.r-real{background:rgba(0,180,216,.05)!important;}
.r-auto{background:rgba(0,119,182,.03)!important;}
.r-var{background:rgba(0,0,0,.03)!important;}
.r-magic td:first-child{color:#0077b6!important;}
.r-magic td:nth-child(3){color:#0a2e4d!important;}
.r-auto td:nth-child(3){color:#0077b6!important;}
.ktable td{border-bottom-color:rgba(126,200,227,.3)!important;}
.dev-bar{background:rgba(0,119,182,.08)!important;}
.dev-row .pct{font-family:'Nunito',sans-serif!important;}
.dev-total .val{font-family:'Fredoka One',cursive!important;}
.container{padding-bottom:60px!important;}

/* Popup T√≠a WhatsApp */
.tia-overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:99999;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .5s;pointer-events:none;}
.tia-overlay.show{opacity:1;pointer-events:all;}
.tia-popup{background:linear-gradient(145deg,#fff0f6,#ffe0ec,#ffd6e8);border:4px solid #ff69b4;border-radius:24px;padding:0;max-width:420px;width:92%;box-shadow:0 12px 50px rgba(255,105,180,.4),0 0 80px rgba(255,182,193,.3);transform:scale(.7) rotate(-3deg);transition:transform .5s cubic-bezier(.34,1.56,.64,1);overflow:hidden;position:relative;}
.tia-overlay.show .tia-popup{transform:scale(1) rotate(0deg);}
.tia-popup-header{background:linear-gradient(135deg,#ff69b4,#ff1493,#ff69b4);padding:10px 16px;display:flex;align-items:center;gap:8px;}
.tia-popup-header .tia-fwd{font-size:10px;color:rgba(255,255,255,.9);font-style:italic;letter-spacing:.5px;}
.tia-popup-header .tia-fwd::before{content:'‚Ü™Ô∏è ';}
.tia-img-container{position:relative;width:100%;padding:20px;text-align:center;background:linear-gradient(180deg,rgba(255,182,193,.2),rgba(255,192,203,.1));}
.tia-bunnies{font-size:100px;line-height:1;filter:drop-shadow(0 4px 12px rgba(255,105,180,.3));animation:tia-bounce 2s ease-in-out infinite;}
@keyframes tia-bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.tia-hearts{position:absolute;top:10px;left:0;right:0;font-size:22px;letter-spacing:12px;text-align:center;animation:tia-pulse 1.5s ease-in-out infinite;}
@keyframes tia-pulse{0%,100%{opacity:.5;transform:scale(1)}50%{opacity:1;transform:scale(1.15)}}
.tia-frase{padding:16px 24px 8px;font-family:'Fredoka One',cursive;font-size:17px;color:#d63384;text-align:center;line-height:1.5;text-shadow:1px 1px 0 rgba(255,255,255,.8);}
.tia-firma{padding:4px 24px 16px;font-size:11px;color:#e75480;text-align:center;font-style:italic;opacity:.8;}
.tia-sparkles{padding:0 24px 12px;text-align:center;font-size:16px;letter-spacing:6px;}
.tia-close{position:absolute;top:10px;right:12px;background:rgba(255,255,255,.7);border:2px solid #ff69b4;border-radius:50%;width:32px;height:32px;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#ff1493;font-weight:700;z-index:2;transition:all .2s;}.tia-close:hover{background:#ff69b4;color:white;transform:scale(1.1) rotate(90deg);}
.tia-btn{display:block;margin:0 auto 20px;padding:10px 28px;background:linear-gradient(135deg,#ff69b4,#ff1493);color:white;border:none;border-radius:30px;font-family:'Fredoka One',cursive;font-size:13px;cursor:pointer;letter-spacing:1px;box-shadow:0 4px 15px rgba(255,20,147,.3);transition:all .2s;}.tia-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(255,20,147,.5);}
</style>
</head>
<body>
<div class="sea-deco">ü¶ë</div>
<div class="sea-deco">‚öì</div>
<div class="sea-deco">üè¥‚Äç‚ò†Ô∏è</div>
<div class="sea-deco">üêö</div>
<div class="sea-deco">ü¶Ä</div>
<div class="sea-deco">üó°Ô∏è</div>
<div class="sea-swimmer">ü¶à</div>
<div class="sea-swimmer">üêô</div>
<div class="login-overlay" id="loginOverlay"><div class="login-box"><div class="logo">üè¥‚Äç‚ò†Ô∏è</div><h1>REVENUE CREW - ABOARD!</h1><div class="sub">‚öì Magic Ball 2.0 ‚Äî BBVA Sales Plan Serie C ‚öì<br>Introduce tu email de Sesame y la contrase√±a, marinero</div><input type="email" id="loginEmail" placeholder="tu.nombre@sesametime.com" onkeydown="if(event.key==='Enter')document.getElementById('loginPass').focus()"/><input type="password" id="loginPass" placeholder="Contrase√±a" onkeydown="if(event.key==='Enter')doLogin()" style="margin-top:4px;"/><button class="btn-login" onclick="doLogin()">‚öì ZARPAR ‚öì</button><div class="err" id="loginErr"></div></div></div>
<div class="header"><div class="header-top"><div><h1>üåä REVENUE CREW ‚Äî CONTROL DECK ü¶à</h1><div class="header-sub">‚öì Actualizacion semanal (viernes) ¬∑ Magic Ball 2.0 ¬∑ Navegando los mares del revenue</div></div><div class="header-right"><div class="header-badge" id="fbStatus" title="Estado Firebase">‚è≥</div><div class="header-badge" id="lastUpdate">SIN DATOS</div><div class="user-badge" id="userBadge" onclick="doLogout()" title="Click para cerrar sesion">‚Äî</div></div></div></div>
<div class="tab-bar"><div class="tab t-inbound active" onclick="switchTab('inbound')">üêô Inbound</div><div class="tab t-outbound" onclick="switchTab('outbound')">‚ò†Ô∏è Outbound</div><div class="tab t-ae" onclick="switchTab('ae')">‚öîÔ∏è Account Exec</div><div class="tab t-general" onclick="switchTab('general')">üß≠ General</div>
<div class="tab-controls"><select id="monthSelect" class="month-select"></select><div class="view-toggle">
    <button class="view-btn active" onclick="setView('normal')" id="btn-normal">DATOS</button>
    <button class="view-btn" onclick="setView('hoy')" id="btn-hoy">üìç HOY</button>
    <button class="view-btn" onclick="setView('proj')" id="btn-proj">üìà PROYECCI√ìN</button>
  </div><button class="btn btn-export" onclick="exportCSV()">‚¨á CSV</button><button class="btn btn-report" onclick="sendReport()">üìß REPORTE</button><button class="btn btn-save" onclick="saveData()">üíæ GUARDAR</button></div></div>
<div id="page_inbound" class="tab-page active"><div class="container" id="ct_inbound"></div></div>
<div id="page_outbound" class="tab-page"><div class="container" id="ct_outbound"></div></div>
<div id="page_ae" class="tab-page"><div class="container" id="ct_ae"></div></div>
<div id="page_general" class="tab-page"><div class="container" id="ct_general"></div></div>
<div class="toast" id="toast"></div>
<script>

// ===== View Toggle State =====
let curView = 'normal'; // 'normal', 'hoy', 'proj'

// ===== Business Days Helper Functions =====
function bizDaysInMonth(mi) {
  const monthNames = ["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];
  const monthStr = MONTHS[mi];
  const parts = monthStr.split(' ');
  const mIdx = monthNames.indexOf(parts[0]);
  const year = parseInt(parts[1]);
  const daysInMonth = new Date(year, mIdx+1, 0).getDate();
  let biz = 0;
  for(let d=1; d<=daysInMonth; d++) {
    const dw = new Date(year, mIdx, d).getDay();
    if(dw !== 0 && dw !== 6) biz++;
  }
  return biz;
}

function bizDaysElapsed(mi) {
  const monthNames = ["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];
  const parts = MONTHS[mi].split(' ');
  const mIdx = monthNames.indexOf(parts[0]);
  const year = parseInt(parts[1]);
  const today = new Date('2026-02-24');
  const monthStart = new Date(year, mIdx, 1);
  const monthEnd = new Date(year, mIdx+1, 0);
  const endDate = today < monthEnd ? today : monthEnd;
  if(today < monthStart) return 0;
  let biz = 0;
  for(let d=1; d<=endDate.getDate(); d++) {
    const dt = new Date(year, mIdx, d);
    if(dt > endDate) break;
    const dw = dt.getDay();
    if(dw !== 0 && dw !== 6) biz++;
  }
  return biz;
}

function calDaysInMonth(mi){
  const monthNames=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];
  const parts=MONTHS[mi].split(' ');
  const mIdx=monthNames.indexOf(parts[0]);
  const year=parseInt(parts[1]);
  return new Date(year,mIdx+1,0).getDate();
}
function calDaysElapsed(mi){
  const monthNames=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];
  const parts=MONTHS[mi].split(' ');
  const mIdx=monthNames.indexOf(parts[0]);
  const year=parseInt(parts[1]);
  const today=new Date('2026-02-24');
  const monthStart=new Date(year,mIdx,1);
  const monthEnd=new Date(year,mIdx+1,0);
  if(today<monthStart)return 0;
  if(today>=monthEnd)return monthEnd.getDate();
  return today.getDate();
}
function project(real,mi){
  if(real==null)return null;
  const elapsed=calDaysElapsed(mi);
  const total=calDaysInMonth(mi);
  if(elapsed===0)return null;
  return real/elapsed*total;
}
function monthPace(mi){
  const elapsed=calDaysElapsed(mi);
  const total=calDaysInMonth(mi);
  if(total===0)return 0;
  return elapsed/total;
}

// ===== View Toggle Functions =====
function setView(view) {
  curView = view;
  document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
  if(view === 'normal') document.getElementById('btn-normal')?.classList.add('active');
  else if(view === 'hoy') document.getElementById('btn-hoy')?.classList.add('active');
  else if(view === 'proj') document.getElementById('btn-proj')?.classList.add('active');
  render();
}

function renderPaceProgressCard(kpiName, real, target, mi) {
  if(real == null) return '';
  const pace = monthPace(mi);
  const elapsed = bizDaysElapsed(mi);
  const total = bizDaysInMonth(mi);
  const pctOfTarget = target > 0 ? (real / target) : 0;
  const ahead = pctOfTarget > pace;
  const status = ahead ? 'ahead' : (Math.abs(pctOfTarget - pace) < 0.1 ? 'onpace' : 'behind');
  
  return `<div class="pace-card">
    <div class="title">${kpiName}</div>
    <div class="status-line">Llevas ${real} de ${target} (${Math.round(pctOfTarget*100)}% del objetivo)</div>
    <div class="pace-bar"><div class="pace-fill ${status}" style="width:${Math.min(100, pctOfTarget*100)}%"></div></div>
    <div class="pace-stats">
      <div class="pace-stat"><span class="label">Valor:</span><span class="value">${real}</span></div>
      <div class="pace-stat"><span class="label">Objetivo:</span><span class="value">${target}</span></div>
      <div class="pace-stat"><span class="label">Ritmo:</span><span class="value">${Math.round(pace*100)}%</span></div>
      <div class="pace-stat"><span class="label">D√≠as:</span><span class="value">${elapsed}/${total}</span></div>
    </div>
  </div>`;
}

function renderProjectionCard(kpiName, real, target, mi) {
  if(real == null) return '';
  const proj = project(real, mi);
  if(proj == null) return '';
  const pctProj = target > 0 ? (proj / target) : 0;
  
  return `<div class="pace-card">
    <div class="title">${kpiName}</div>
    <div class="proj-line">
      <span class="proj-label">Proyecci√≥n cierre:</span>
      <span class="proj-value">${Math.round(proj)} (${Math.round(pctProj*100)}%)</span>
    </div>
    <div class="proj-line">
      <span class="proj-label">Ritmo actual ‚Üí Objetivo:</span>
      <span class="proj-value">${Math.round(proj)} / ${target}</span>
    </div>
  </div>`;
}


function renderSemaforo(mi) {
  let h = '<div class="semaforo-grid">';
  AE_TEAMS.forEach(team => {
    const prefix = 'ae_' + team.id + '_';
    const sqlsReal = gv(prefix + 'sqls', mi);
    const sqlsMagic = Math.round(MA.sqls[mi] * team.members.length / 17);
    let projPct = null;
    let projVal = null;
    if (sqlsReal != null) {
      projVal = project(sqlsReal, mi);
      if (projVal != null && sqlsMagic > 0) {
        projPct = projVal / sqlsMagic;
      }
    }
    let semClass = 'sem-gray';
    let semLabel = 'Sin datos';
    if (projPct != null) {
      const pct100 = Math.round(projPct * 100);
      semLabel = pct100 + '%';
      if (projPct >= 0.90) semClass = 'sem-green';
      else if (projPct >= 0.80) semClass = 'sem-yellow';
      else semClass = 'sem-red';
    }
    h += `<div class="semaforo-card">
      <img src="${CRESTS[team.id]}" alt="${team.name}"/>
      <div class="sem-light ${semClass}"></div>
      <div class="sem-info">
        <div class="sem-team" style="color:${team.color}">${team.houseName || team.name.toUpperCase()}</div>
        <div class="sem-pct ${semClass === 'sem-green' ? 'delta-pos' : semClass === 'sem-red' ? 'delta-neg' : 'delta-none'}">${semLabel}</div>
        <div class="sem-detail">${projVal != null ? 'Proy: ' + Math.round(projVal) + ' / Obj: ' + sqlsMagic + ' SQLs' : 'Introduce SQLs del equipo'}</div>
      </div>
    </div>`;
  });
  h += '</div>';
  return h;
}

const MONTHS=["Ene 2025", "Feb 2025", "Mar 2025", "Abr 2025", "May 2025", "Jun 2025", "Jul 2025", "Ago 2025", "Sep 2025", "Oct 2025", "Nov 2025", "Dic 2025", "Ene 2026", "Feb 2026", "Mar 2026", "Abr 2026", "May 2026", "Jun 2026", "Jul 2026", "Ago 2026", "Sep 2026", "Oct 2026", "Nov 2026", "Dic 2026"];
const CRESTS={"espartanos": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjQwIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImdlMSIgeDE9IjAiIHkxPSIwIiB4Mj0iMCIgeTI9IjEiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNkNGE1NDMiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM4YjY5MTQiLz48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0iZ2UyIiB4MT0iMCIgeTE9IjAiIHgyPSIwIiB5Mj0iMSI+PHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2M2MjgyOCIvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzdmMDAwMCIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxwYXRoIGQ9Ik0xMDAgMTAgTDE4NSA1MCBMMTg1IDE0MCBRMTg1IDIwMCAxMDAgMjMwIFExNSAyMDAgMTUgMTQwIEwxNSA1MCBaIiBmaWxsPSJ1cmwoI2dlMikiIHN0cm9rZT0idXJsKCNnZTEpIiBzdHJva2Utd2lkdGg9IjUiLz48cGF0aCBkPSJNMTAwIDI1IEwxNzAgNjAgTDE3MCAxMzUgUTE3MCAxODUgMTAwIDIxNSBRMzAgMTg1IDMwIDEzNSBMMzAgNjAgWiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZDRhNTQzIiBzdHJva2Utd2lkdGg9IjEuNSIgb3BhY2l0eT0iLjUiLz48dGV4dCB4PSIxMDAiIHk9Ijk1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjZDRhNTQzIiBmb250LXNpemU9IjUyIj4mIzk4NzY7PC90ZXh0Pjx0ZXh0IHg9IjEwMCIgeT0iMTQwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjZDRhNTQzIiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZXR0ZXItc3BhY2luZz0iMyI+SFVGRkxFPC90ZXh0Pjx0ZXh0IHg9IjEwMCIgeT0iMTU4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjZmZkNzQwIiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZXR0ZXItc3BhY2luZz0iNCI+U1BBUlRBTjwvdGV4dD48bGluZSB4MT0iNTUiIHkxPSIxNjYiIHgyPSIxNDUiIHkyPSIxNjYiIHN0cm9rZT0iI2Q0YTU0MyIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIuNCIvPjx0ZXh0IHg9IjEwMCIgeT0iMTg0IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjZDRhNTQzIiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iOCIgbGV0dGVyLXNwYWNpbmc9IjIiIG9wYWNpdHk9Ii43Ij5IT05PUiAmIzE4MzsgRlVFUlpBPC90ZXh0Pjwvc3ZnPg==", "abejitas": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjQwIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImdhMSIgeDE9IjAiIHkxPSIwIiB4Mj0iMCIgeTI9IjEiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNmZmQ3NDAiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNmOWE4MjUiLz48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0iZ2EyIiB4MT0iMCIgeTE9IjAiIHgyPSIwIiB5Mj0iMSI+PHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzFhMjM3ZSIvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzBkMTY0MiIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxwYXRoIGQ9Ik0xMDAgMTAgTDE4NSA1MCBMMTg1IDE0MCBRMTg1IDIwMCAxMDAgMjMwIFExNSAyMDAgMTUgMTQwIEwxNSA1MCBaIiBmaWxsPSJ1cmwoI2dhMikiIHN0cm9rZT0idXJsKCNnYTEpIiBzdHJva2Utd2lkdGg9IjUiLz48cGF0aCBkPSJNMTAwIDI1IEwxNzAgNjAgTDE3MCAxMzUgUTE3MCAxODUgMTAwIDIxNSBRMzAgMTg1IDMwIDEzNSBMMzAgNjAgWiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmZkNzQwIiBzdHJva2Utd2lkdGg9IjEuNSIgb3BhY2l0eT0iLjUiLz48dGV4dCB4PSIxMDAiIHk9IjEwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSI1MiI+JiN4MUY0MUQ7PC90ZXh0Pjx0ZXh0IHg9IjEwMCIgeT0iMTQwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjZmZkNzQwIiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZXR0ZXItc3BhY2luZz0iMyI+UkFWRU48L3RleHQ+PHRleHQgeD0iMTAwIiB5PSIxNTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiNmZmQ3NDAiIGZvbnQtZmFtaWx5PSJzZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxldHRlci1zcGFjaW5nPSI0Ij5CRUU8L3RleHQ+PGxpbmUgeDE9IjU1IiB5MT0iMTY2IiB4Mj0iMTQ1IiB5Mj0iMTY2IiBzdHJva2U9IiNmZmQ3NDAiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iLjQiLz48dGV4dCB4PSIxMDAiIHk9IjE4NCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iI2ZmZDc0MCIgZm9udC1mYW1pbHk9InNlcmlmIiBmb250LXNpemU9IjgiIGxldHRlci1zcGFjaW5nPSIyIiBvcGFjaXR5PSIuNyI+SU5HRU5JTyAmIzE4MzsgRFVMWlVSQTwvdGV4dD48L3N2Zz4=", "calamares": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjQwIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImdjMSIgeDE9IjAiIHkxPSIwIiB4Mj0iMCIgeTI9IjEiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNlMDQwZmIiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM5YzI3YjAiLz48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0iZ2MyIiB4MT0iMCIgeTE9IjAiIHgyPSIwIiB5Mj0iMSI+PHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzRhMGUyZSIvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzFhMDAxMCIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxwYXRoIGQ9Ik0xMDAgMTAgTDE4NSA1MCBMMTg1IDE0MCBRMTg1IDIwMCAxMDAgMjMwIFExNSAyMDAgMTUgMTQwIEwxNSA1MCBaIiBmaWxsPSJ1cmwoI2djMikiIHN0cm9rZT0idXJsKCNnYzEpIiBzdHJva2Utd2lkdGg9IjUiLz48cGF0aCBkPSJNMTAwIDI1IEwxNzAgNjAgTDE3MCAxMzUgUTE3MCAxODUgMTAwIDIxNSBRMzAgMTg1IDMwIDEzNSBMMzAgNjAgWiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZTA0MGZiIiBzdHJva2Utd2lkdGg9IjEuNSIgb3BhY2l0eT0iLjUiLz48dGV4dCB4PSIxMDAiIHk9IjEwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSI1MiI+JiN4MUY5OTE7PC90ZXh0Pjx0ZXh0IHg9IjEwMCIgeT0iMTQwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjZTA0MGZiIiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZXR0ZXItc3BhY2luZz0iMyI+S1JBS0VOPC90ZXh0Pjx0ZXh0IHg9IjEwMCIgeT0iMTU4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjZmY2ZWM3IiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZXR0ZXItc3BhY2luZz0iNCI+Rk9SPC90ZXh0PjxsaW5lIHgxPSI1NSIgeTE9IjE2NiIgeDI9IjE0NSIgeTI9IjE2NiIgc3Ryb2tlPSIjZTA0MGZiIiBzdHJva2Utd2lkdGg9IjEiIG9wYWNpdHk9Ii40Ii8+PHRleHQgeD0iMTAwIiB5PSIxODQiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiNlMDQwZmIiIGZvbnQtZmFtaWx5PSJzZXJpZiIgZm9udC1zaXplPSI4IiBsZXR0ZXItc3BhY2luZz0iMiIgb3BhY2l0eT0iLjciPkFNQklDSU9OICYjMTgzOyBDQU9TPC90ZXh0Pjwvc3ZnPg==", "tiburones": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjQwIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9Imd0MSIgeDE9IjAiIHkxPSIwIiB4Mj0iMCIgeTI9IjEiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiM2OWYwYWUiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMwMDg5N2IiLz48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0iZ3QyIiB4MT0iMCIgeTE9IjAiIHgyPSIwIiB5Mj0iMSI+PHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzBhMmUyNiIvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzAwMWExNCIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxwYXRoIGQ9Ik0xMDAgMTAgTDE4NSA1MCBMMTg1IDE0MCBRMTg1IDIwMCAxMDAgMjMwIFExNSAyMDAgMTUgMTQwIEwxNSA1MCBaIiBmaWxsPSJ1cmwoI2d0MikiIHN0cm9rZT0idXJsKCNndDEpIiBzdHJva2Utd2lkdGg9IjUiLz48cGF0aCBkPSJNMTAwIDI1IEwxNzAgNjAgTDE3MCAxMzUgUTE3MCAxODUgMTAwIDIxNSBRMzAgMTg1IDMwIDEzNSBMMzAgNjAgWiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNjlmMGFlIiBzdHJva2Utd2lkdGg9IjEuNSIgb3BhY2l0eT0iLjUiLz48dGV4dCB4PSIxMDAiIHk9IjEwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSI1MiI+JiN4MUY5ODg7PC90ZXh0Pjx0ZXh0IHg9IjEwMCIgeT0iMTQwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjNjlmMGFlIiBmb250LWZhbWlseT0ic2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZXR0ZXItc3BhY2luZz0iMyI+U0xJVEhFUjwvdGV4dD48dGV4dCB4PSIxMDAiIHk9IjE1OCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iI2IyZGZkYiIgZm9udC1mYW1pbHk9InNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGV0dGVyLXNwYWNpbmc9IjQiPlNIQVJLPC90ZXh0PjxsaW5lIHgxPSI1NSIgeTE9IjE2NiIgeDI9IjE0NSIgeTI9IjE2NiIgc3Ryb2tlPSIjNjlmMGFlIiBzdHJva2Utd2lkdGg9IjEiIG9wYWNpdHk9Ii40Ii8+PHRleHQgeD0iMTAwIiB5PSIxODQiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiM2OWYwYWUiIGZvbnQtZmFtaWx5PSJzZXJpZiIgZm9udC1zaXplPSI4IiBsZXR0ZXItc3BhY2luZz0iMiIgb3BhY2l0eT0iLjciPkFTVFVDSUEgJiMxODM7IFZFTE9DSURBRDwvdGV4dD48L3N2Zz4=", "inbound": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj48ZGVmcz48cmFkaWFsR3JhZGllbnQgaWQ9ImdpMSI+PHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2U4ZjhmZiIvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzQ4Y2FlNCIvPjwvcmFkaWFsR3JhZGllbnQ+PC9kZWZzPjxjaXJjbGUgY3g9IjEwMCIgY3k9IjEwMCIgcj0iOTUiIGZpbGw9InVybCgjZ2kxKSIgc3Ryb2tlPSIjMDA3N2I2IiBzdHJva2Utd2lkdGg9IjMiLz48dGV4dCB4PSIxMDAiIHk9IjU1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjEwIiBmb250LXdlaWdodD0iOTAwIiBmaWxsPSIjMGEyZTRkIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgbGV0dGVyLXNwYWNpbmc9IjIiPkxPUyBMSU5DRVM8L3RleHQ+PHRleHQgeD0iMTAwIiB5PSIxMjUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtc2l6ZT0iNTIiPiYjeDFGNDMxOzwvdGV4dD48dGV4dCB4PSIxMDAiIHk9IjE2NSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9IjkwMCIgZmlsbD0iIzAwNzdiNiIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGxldHRlci1zcGFjaW5nPSIyIj5SQVZFUlM8L3RleHQ+PHBhdGggZD0iTTUwIDgwIFExMDAgNjUgMTUwIDgwIiBmaWxsPSJub25lIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjE4IiBvcGFjaXR5PSIuMjUiLz48cGF0aCBkPSJNNTAgMTQ1IFExMDAgMTYwIDE1MCAxNDUiIGZpbGw9Im5vbmUiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMTgiIG9wYWNpdHk9Ii4yNSIvPjwvc3ZnPgo=", "outbound": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjIwIj48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIyMCIgcng9IjEwIiBmaWxsPSIjZTBlMGUwIiBvcGFjaXR5PSIuMDUiLz48dGV4dCB4PSIxMDAiIHk9IjQwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjIyIiBmb250LXdlaWdodD0iOTAwIiBmaWxsPSIjZTBlMGUwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgbGV0dGVyLXNwYWNpbmc9IjMiPk9VVEJPVU5EPC90ZXh0Pjx0ZXh0IHg9IjEwMCIgeT0iMTQwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjkwIj4mI3gyNjIwOzwvdGV4dD48cGF0aCBkPSJNNjAgMTcwIEw4MCAxODAgTDYwIDE5MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNzg5MDljIiBzdHJva2Utd2lkdGg9IjMiLz48cGF0aCBkPSJNMTQwIDE3MCBMMTIwIDE4MCBMMTQwIDE5MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNzg5MDljIiBzdHJva2Utd2lkdGg9IjMiLz48L3N2Zz4="};
const MI={mqls_paid:[2304,1785,2191,2128,2044,1437,1236,1168,1591,1658,1674,1708,1824,1897,1973,2032,2093,2156,2199,2243,2288,2334,2381,2428],sqls_paid:[290,252,344,338,296,240,180,126,255,274,276,282,301,313,326,335,345,356,363,370,378,385,393,401],arpa_paid:[120,120,120,120,120,120,120,120,120,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130],rate_paid:[.126,.141,.157,.159,.145,.167,.146,.108,.160,.165,.165,.165,.165,.165,.165,.165,.165,.165,.165,.165,.165,.165,.165,.165],mqls_inbound:[995,802,1058,835,957,934,792,442,920,930,958,987,1017,1048,1079,1101,1123,1145,973,632,1169,1192,1216,1240],sqls_inbound:[224,237,209,224,304,295,258,137,335,288,297,306,331,341,351,358,365,372,316,205,380,387,395,403],arpa_inbound:[130,130,130,130,130,130,130,130,130,137,137,137,147.96,147.96,147.96,147.96,147.96,147.96,147.96,147.96,147.96,147.96,147.96,147.96],rate_inbound:[.225,.296,.198,.268,.318,.316,.326,.310,.364,.310,.310,.310,.325,.325,.325,.325,.325,.325,.325,.325,.325,.325,.325,.325],sdrs_in:[9,9,9,9,9,9,9,6,7,7,7,7,8,8,8,8,9,9,9,9,9,10,10,10],direct_mrr:[20754,28939,27525,19130,27965,18923,19426,10175,25522,23188,25603,24028,28300,31300,33000,33700,34400,35300,33400,15400,39900,40900,39200,35600]};
const MO={sdrs_out:[15,15,15,15,16,17,17,17,17,16,16,16,12,12,14,16,16,16,16,16,16,16,16,16],sqls_out:[120,120,120,90,120,120,96,68,153,144,144,112,120,120,120,120,140,160,128,96,160,160,160,128],rate_sql_hql:[.82,.82,.82,.82,.82,.82,.82,.82,.82,.82,.82,.82,.85,.85,.85,.85,.85,.85,.85,.85,.85,.85,.85,.85],arpa_out:[331.16,426.25,422.96,534.79,442.92,539.3,700,676.72,585,585,585,585,631.8,631.8,631.8,631.8,631.8,631.8,631.8,631.8,631.8,631.8,631.8,631.8],conv_client:[.161,.14,.191,.14,.14,.14,.14,.14,.15,.12,.12,.12,.12,.12,.12,.12,.12,.12,.12,.12,.12,.12,.12,.12],new_mrr_out:[7795,4894,7610,5582,7317,7732,2153,4629,8000,11194,10807,9890,9100,8900,8900,8800,9100,9900,10700,7600,10000,10900,11300,10800]};
const MA={direct_mrr:[28870,36557,35629,24924,36183,26913,23728,14804,33627,34660,36870,34373,38000,41100,43100,44200,45800,48500,48000,24900,55300,57500,56100,51600],arpa:[145.81,161.04,162.69,133.28,153.97,139.45,153.08,159.18,177.92,174.17,172.29,172.73,169.64,168.44,168.36,168.06,169.00,171.38,174.55,188.64,167.58,169.12,171.56,173.15],sqls:[636.6,623.6,673.6,653.8,717.6,654.6,532.8,330.2,742,710.6,721.6,706.4,764.4,790.4,817.4,842.4,889.8,943.2,866.8,724.4,983.2,1003.2,1023.2,1006.8],rate_in:[.3854,.3715,.3363,.3062,.3467,.3464,.3356,.3232,.3125,.3497,.3517,.3490,.3520,.3518,.3525,.3514,.3534,.3538,.3492,.3355,.3537,.3548,.3535,.3527],rate_out:[.161,.14,.191,.14,.14,.14,.14,.14,.15,.12,.12,.12,.12,.12,.12,.12,.12,.12,.12,.12,.12,.12,.12,.12],ae_activos:[17,17,18,18,19,19,19,19,20,20,20,20,20,21,22,22,23,25,25,25,26,26,27,27]};
const SDR_IN={"Viviana Orofino": {"sqls": 75, "avg_act": 9.0, "avg_cont": 7.3, "lastAct": "2026-02-23"}, "Fernanda Parra": {"sqls": 15, "avg_act": 8.5, "avg_cont": 6.6, "lastAct": "2026-02-21"}, "Julian Lopez": {"sqls": 28, "avg_act": 7.3, "avg_cont": 5.0, "lastAct": "2026-02-23"}, "Nuria Ballesteros": {"sqls": 38, "avg_act": 8.0, "avg_cont": 6.0, "lastAct": "2026-02-23"}, "Irene Roig": {"sqls": 44, "avg_act": 6.0, "avg_cont": 4.1, "lastAct": "2026-02-20"}};
const TEAM_ACT={sdr_in:{hist:6.3,month:3.7},sdr_out:{hist:6.4,month:7.2},espartanos:{hist:24.9,month:21.1},abejitas:{hist:22.1,month:25.1},calamares:{hist:20.0,month:14.3},tiburones:{hist:28.8,month:38.3},ae_total:{hist:25.8,month:24.5}};
const SDR_PRESSURE={sdr_in:{hist_avg:267.3,months:[{m:'Sep 25',deals:1639,sdrs:7,mqls:234.1},{m:'Oct 25',deals:1865,sdrs:7,mqls:266.4},{m:'Nov 25',deals:1804,sdrs:7,mqls:257.7},{m:'Dec 25',deals:1980,sdrs:7,mqls:282.9},{m:'Ene 26',deals:2361,sdrs:8,mqls:295.1}],curr_deals:2121,curr_date:'2026-02-24'}};
const SDR_OUT={"Carlos Perez": {"sqls": 34, "avg_act": 6.0, "avg_cont": 4.1, "lastAct": "2026-02-23"}, "Paco Gomez": {"sqls": 21, "avg_act": 5.3, "avg_cont": 4.0, "lastAct": "2026-02-23"}, "Isabel Gay": {"sqls": 20, "avg_act": 4.0, "avg_cont": 3.2, "lastAct": "2026-02-21"}, "Paula Peiro": {"sqls": 19, "avg_act": 4.1, "avg_cont": 2.1, "lastAct": "2026-02-23"}, "Sedik Aniss": {"sqls": 18, "avg_act": 4.2, "avg_cont": 2.5, "lastAct": "2026-02-23"}, "Angel Cerda": {"sqls": 18, "avg_act": 8.8, "avg_cont": 3.4, "lastAct": "2026-02-23"}, "Veronica Herrera": {"sqls": 16, "avg_act": 3.5, "avg_cont": 2.2, "lastAct": "2026-02-21"}, "Ivan Monros": {"sqls": 15, "avg_act": 4.5, "avg_cont": 2.4, "lastAct": "2026-02-23"}, "Georgina Filomeni": {"sqls": 15, "avg_act": 4.6, "avg_cont": 3.0, "lastAct": "2026-02-23"}, "Barbara Marquez": {"sqls": 9, "avg_act": 7.9, "avg_cont": 5.4, "lastAct": "2026-02-20"}, "Juan Jose Herrera": {"sqls": 9, "avg_act": 5.8, "avg_cont": 4.4, "lastAct": "2026-02-23"}, "Juan Borreda": {"sqls": 6, "avg_act": 3.5, "avg_cont": 1.8, "lastAct": "2026-02-19"}};
const AE_TEAMS=[
{id:'espartanos',name:'Espartanos',houseName:'HUFFLESPARTAN',color:'#ff5252',members:[{name:'Mario Quintero',sqls:307,avg_act:10.49,avg_notes:16.38,lastAct:'2026-02-22'},{name:'Pablo Garcia Molins',sqls:80,avg_act:11.59,avg_notes:15.91,lastAct:'2026-02-23'},{name:'David Melia',sqls:112,avg_act:14.38,avg_notes:20.39,lastAct:'2026-02-23'},{name:'Ronny Navarrete',sqls:206,avg_act:12.16,avg_notes:18.72,lastAct:'2026-02-23'}]},
{id:'abejitas',name:'Abejitas',houseName:'RAVENBEE',color:'#ffd740',members:[{name:'Enrique Iadarola',sqls:290,avg_act:13.34,avg_notes:19.45,lastAct:'2026-02-23'},{name:'Marina Robaldo',sqls:262,avg_act:13.56,avg_notes:19.96,lastAct:'2026-02-23'},{name:'Noelia Zamora',sqls:273,avg_act:14.08,avg_notes:20.35,lastAct:'2026-02-23'},{name:'Daniel Bailen',sqls:197,avg_act:12.84,avg_notes:16.34,lastAct:'2026-02-23'},{name:'Ali Jesus',sqls:256,avg_act:13.74,avg_notes:19.63,lastAct:'2026-02-23'}]},
{id:'calamares',name:'Calamares del Infierno',houseName:'KRAKENFOR',color:'#e040fb',members:[{name:'Vanesa Perez',sqls:485,avg_act:13.37,avg_notes:20.99,lastAct:'2026-02-23'},{name:'Cristian',sqls:415,avg_act:12.78,avg_notes:19.80,lastAct:'2026-02-23'},{name:'Lorena Aran',sqls:462,avg_act:16.48,avg_notes:24.68,lastAct:'2026-02-23'},{name:'Maribel Ortuno',sqls:270,avg_act:12.74,avg_notes:21.59,lastAct:'2026-02-23'},{name:'Jose Nunez',sqls:549,avg_act:10.45,avg_notes:15.85,lastAct:'2026-02-23'}]},
{id:'tiburones',name:'Tiburones',houseName:'SLITHERSHARK',color:'#448aff',members:[{name:'Eduardo Solana',sqls:593,avg_act:11.28,avg_notes:18.17,lastAct:'2026-02-23'},{name:'Alba Gijon',sqls:263,avg_act:14.52,avg_notes:24.63,lastAct:'2026-02-23'},{name:'Fernando Lopez',sqls:496,avg_act:11.45,avg_notes:19.97,lastAct:'2026-02-23'}]}];
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   üî• FIREBASE CONFIG ‚Äî RELLENAR CON TUS CREDENCIALES
   Ir a console.firebase.google.com ‚Üí tu proyecto ‚Üí
   Configuraci√≥n ‚Üí General ‚Üí Tu app web ‚Üí Config
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const FIREBASE_CONFIG = {
  apiKey: "AIzaSyDEUa4PXlL1JpNwlzC2JZxPhzLU_0rAzCY",
  authDomain: "ow-gee-numbers.firebaseapp.com",
  databaseURL: "https://ow-gee-numbers-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "ow-gee-numbers",
  storageBucket: "ow-gee-numbers.firebasestorage.app",
  messagingSenderId: "662652337876",
  appId: "1:662652337876:web:f32f98f899739e9e0e4541"
};

let fbReady = false;
let fbRef = null;
let fbMetaRef = null;
let fbSnapRef = null;
try {
  firebase.initializeApp(FIREBASE_CONFIG);
  fbRef = firebase.database().ref('panel_data');
  fbMetaRef = firebase.database().ref('panel_meta');
  fbSnapRef = firebase.database().ref('panel_snapshots');
  fbReady = true;
} catch(e) {
  console.warn('Firebase no configurado, usando localStorage como fallback.', e);
}

let curMonth=13,curTab='inbound',curAESub='general',realData={},curUser=null;
let fbSyncing = false; /* flag para evitar loops de render */
function bizDaysSince(ds){if(!ds)return 999;const d=new Date(ds),now=new Date('2026-02-24');let c=0,cur=new Date(d);cur.setDate(cur.getDate()+1);while(cur<=now){const dw=cur.getDay();if(dw!==0&&dw!==6)c++;cur.setDate(cur.getDate()+1);}return c;}
function isActive(ds){return bizDaysSince(ds)<5;}function filterActive(ms){return ms.filter(m=>isActive(m.lastAct));}
function filterActiveObj(o){const r={};Object.entries(o).forEach(([k,v])=>{if(isActive(v.lastAct))r[k]=v;});return r;}
function doLogin(){const e=document.getElementById('loginEmail').value.trim().toLowerCase();const p=document.getElementById('loginPass').value;if(!e.includes('@sesametime.com')&&!e.includes('@sesame.co')){document.getElementById('loginErr').textContent='Introduce un email valido de Sesame';return;}if(p!=='fucktorial'){document.getElementById('loginErr').textContent='Contrase√±a incorrecta';return;}curUser=e;localStorage.setItem('panel_user',e);document.getElementById('loginOverlay').classList.add('hidden');document.getElementById('userBadge').textContent='üë§ '+e.split('@')[0];
  if(fbReady){const uRef=firebase.database().ref('panel_online/'+e.replace(/[.@]/g,'_'));uRef.set({name:e.split('@')[0],ts:Date.now()});uRef.onDisconnect().remove();}
  render();}
function doLogout(){curUser=null;localStorage.removeItem('panel_user');location.reload();}
function checkLogin(){const s=localStorage.getItem('panel_user');if(s){curUser=s;document.getElementById('loginOverlay').classList.add('hidden');document.getElementById('userBadge').textContent='üë§ '+s.split('@')[0];
  if(fbReady){const uRef=firebase.database().ref('panel_online/'+s.replace(/[.@]/g,'_'));uRef.set({name:s.split('@')[0],ts:Date.now()});uRef.onDisconnect().remove();
  /* Escuchar usuarios online */
  firebase.database().ref('panel_online').on('value',snap=>{const users=snap.val();if(users){const names=Object.values(users).map(u=>u.name);const el=document.getElementById('fbStatus');if(el&&names.length>0)el.title='Online: '+names.join(', ');}});
  }}}
function load(){
  /* Carga local primero (instant√°neo) */
  try{const s=localStorage.getItem('panel_v5');if(s)realData=JSON.parse(s);const t=localStorage.getItem('panel_v5_ts');if(t)document.getElementById('lastUpdate').textContent='üíæ '+t;}catch(e){}
  /* Si Firebase disponible, sincroniza y escucha cambios en tiempo real */
  if(fbReady&&fbRef){
    document.getElementById('fbStatus').textContent='üîÑ';document.getElementById('fbStatus').title='Conectando a Firebase...';
    fbRef.once('value').then(snap=>{
      const d=snap.val();
      if(d){realData=d;localStorage.setItem('panel_v5',JSON.stringify(d));render();}
      document.getElementById('fbStatus').textContent='‚òÅÔ∏è Online';document.getElementById('fbStatus').title='Firebase conectado ‚Äî datos sincronizados en tiempo real';document.getElementById('fbStatus').style.color='var(--grn)';
    }).catch(e=>{console.warn('Firebase load error:',e);document.getElementById('fbStatus').textContent='‚ö†Ô∏è Offline';document.getElementById('fbStatus').title='Firebase no disponible ‚Äî usando datos locales';document.getElementById('fbStatus').style.color='var(--red)';});
    /* Listener en tiempo real: cuando OTRO usuario cambia datos */
    fbRef.on('value',snap=>{
      const d=snap.val();
      if(d&&!fbSyncing){realData=d;localStorage.setItem('panel_v5',JSON.stringify(d));render();document.getElementById('lastUpdate').textContent='üîÑ Sync '+new Date().toLocaleTimeString('es-ES');}
    });
    fbMetaRef.on('value',snap=>{
      const m=snap.val();
      if(m&&m.lastUser&&m.lastUser!==curUser){document.getElementById('lastUpdate').textContent='üîÑ '+m.lastUser.split('@')[0]+' actualiz√≥ a las '+m.ts;}
    });
  } else {
    document.getElementById('fbStatus').textContent='üì¥ Local';document.getElementById('fbStatus').title='Firebase no configurado ‚Äî datos solo en este navegador';document.getElementById('fbStatus').style.color='var(--org)';
  }
}
function saveData(){
  localStorage.setItem('panel_v5',JSON.stringify(realData));
  const n=new Date().toLocaleString('es-ES');
  localStorage.setItem('panel_v5_ts',n);
  document.getElementById('lastUpdate').textContent='üíæ '+n;
  /* Guardar en Firebase */
  if(fbReady&&fbRef){
    fbSyncing=true;
    fbRef.set(realData).then(()=>{
      fbMetaRef.set({lastUser:curUser||'anon',ts:n});
      fbSyncing=false;
      toast('Guardado y sincronizado ‚òÅÔ∏è');
    }).catch(e=>{fbSyncing=false;console.warn('Firebase save error:',e);toast('Guardado local (sin conexi√≥n)');});
  } else {
    toast('Datos guardados (local)');
  }
}
function toast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2500);}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SNAPSHOTS ‚Äî Foto autom√°tica cada viernes 23:00 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function getWeekId(d){const dt=d||new Date();const jan1=new Date(dt.getFullYear(),0,1);const days=Math.floor((dt-jan1)/(24*60*60*1000));const week=Math.ceil((days+jan1.getDay()+1)/7);return dt.getFullYear()+'-W'+String(week).padStart(2,'0');}

function getWeekLabel(d){const dt=d||new Date();const day=dt.getDate(),mo=dt.toLocaleString('es-ES',{month:'short'}),yr=dt.getFullYear();return day+' '+mo+' '+yr;}

function checkAutoSnapshot(){
  if(!fbReady||!fbSnapRef||!Object.keys(realData).length)return;
  const now=new Date();
  /* Solo viernes (5) a partir de 23:00, s√°bado (6) o domingo (0) */
  const dow=now.getDay(),hr=now.getHours();
  const shouldSnap=(dow===5&&hr>=23)||dow===6||dow===0;
  if(!shouldSnap)return;
  /* Calcular qu√© viernes corresponde */
  const fri=new Date(now);if(dow===6)fri.setDate(fri.getDate()-1);else if(dow===0)fri.setDate(fri.getDate()-2);
  const weekId=getWeekId(fri);
  /* Comprobar si ya existe snapshot de esta semana */
  fbSnapRef.child(weekId).once('value').then(snap=>{
    if(snap.exists())return; /* ya hecho */
    const snapshot={
      data:{...realData},
      ts:now.toISOString(),
      label:getWeekLabel(fri),
      month:curMonth,
      user:curUser||'auto'
    };
    fbSnapRef.child(weekId).set(snapshot).then(()=>{
      console.log('üì∏ Snapshot semanal guardado:',weekId);
      toast('üì∏ Foto semanal guardada autom√°ticamente');
    });
  });
}

function takeManualSnapshot(){
  if(!fbReady||!fbSnapRef){toast('Firebase no disponible');return;}
  if(!Object.keys(realData).length){toast('No hay datos para fotografiar');return;}
  const now=new Date();
  const snapId=now.toISOString().slice(0,10)+'_'+now.getHours()+'-'+String(now.getMinutes()).padStart(2,'0');
  const snapshot={
    data:{...realData},
    ts:now.toISOString(),
    label:getWeekLabel(now)+' '+now.toLocaleTimeString('es-ES',{hour:'2-digit',minute:'2-digit'}),
    month:curMonth,
    user:curUser||'manual',
    manual:true
  };
  fbSnapRef.child(snapId).set(snapshot).then(()=>{
    toast('üì∏ Foto manual guardada: '+snapshot.label);
  });
}

let _snapshotsCache=[];
function loadSnapshots(cb){
  if(!fbReady||!fbSnapRef){cb([]);return;}
  fbSnapRef.orderByChild('ts').once('value').then(snap=>{
    const arr=[];
    snap.forEach(c=>{arr.push({id:c.key,...c.val()});});
    _snapshotsCache=arr;
    cb(arr);
  }).catch(()=>cb([]));
}

function renderEvolutivo(mi){
  if(!_snapshotsCache.length)return'<div class="no-data-msg">A√∫n no hay fotos semanales. La primera se tomar√° el viernes a las 23:00, o puedes hacer una foto manual.</div>';
  const snaps=_snapshotsCache.filter(s=>s.month===mi||s.data);
  if(!snaps.length)return'<div class="no-data-msg">No hay fotos para este mes.</div>';
  const kpis=[
    {id:'direct_mrr',label:'MRR Inbound',fmt:'eurInt'},
    {id:'mrr_out',label:'MRR Outbound',fmt:'eurInt'},
    {id:'mqls_paid',label:'MQLs Paid',fmt:'int'},
    {id:'mqls_inbound',label:'MQLs Inbound',fmt:'int'},
    {id:'sqls_paid',label:'SQLs Paid',fmt:'int'},
    {id:'sqls_inbound',label:'SQLs Inbound',fmt:'int'},
    {id:'sqls_out',label:'SQLs Outbound',fmt:'int'},
    {id:'ae_sqls',label:'SQLs AE',fmt:'int'},
    {id:'ae_arpa',label:'ARPA',fmt:'eur'}
  ];
  let h='<div style="overflow-x:auto"><table style="width:100%;border-collapse:collapse;font-size:10px">';
  h+='<tr style="border-bottom:1px solid var(--brd)"><th style="text-align:left;padding:6px;color:var(--dim)">KPI</th>';
  snaps.forEach(s=>{h+='<th style="padding:6px;color:var(--cyan);white-space:nowrap">üì∏ '+s.label+(s.manual?' (manual)':'')+'</th>';});
  h+='<th style="padding:6px;color:var(--grn)">ACTUAL</th></tr>';
  kpis.forEach(kpi=>{
    h+='<tr style="border-bottom:1px solid rgba(42,42,94,.3)"><td style="padding:6px;color:var(--pink);font-weight:600">'+kpi.label+'</td>';
    let prev=null;
    snaps.forEach(s=>{
      const v=s.data[mi+'_'+kpi.id];
      const cls=prev!=null&&v!=null?(v>prev?'delta-pos':(v<prev?'delta-neg':'')):'';
      h+='<td style="padding:6px;text-align:center" class="'+cls+'">'+(v!=null?f(v,kpi.fmt):'‚Äî')+'</td>';
      if(v!=null)prev=v;
    });
    const cur=gv(kpi.id,mi);
    const cls2=prev!=null&&cur!=null?(cur>prev?'delta-pos':(cur<prev?'delta-neg':'')):'';
    h+='<td style="padding:6px;text-align:center;font-weight:700;color:var(--cyan)" class="'+cls2+'">'+(cur!=null?f(cur,kpi.fmt):'‚Äî')+'</td>';
    h+='</tr>';
  });
  h+='</table></div>';
  h+='<div style="margin-top:8px;font-size:9px;color:var(--dim)">Total fotos: '+snaps.length+' ¬∑ <span style="color:var(--grn)">‚ñ≤ verde = subi√≥</span> ¬∑ <span style="color:var(--red)">‚ñº rojo = baj√≥</span></div>';
  return h;
}
function gv(id,mi){return realData[mi+'_'+id]??null;}
let _svTimer=null;
function sv(id,mi,v,skipRender){
  const k=mi+'_'+id;
  const old=realData[k];
  if(v===''||v===null||isNaN(v)){if(old===undefined)return;delete realData[k];}
  else{const nv=parseFloat(v);if(old===nv)return;realData[k]=nv;}
  if(!skipRender)render();
  /* Auto-sync a Firebase con debounce de 800ms */
  localStorage.setItem('panel_v5',JSON.stringify(realData));
  clearTimeout(_svTimer);
  _svTimer=setTimeout(()=>{
    if(fbReady&&fbRef){
      fbSyncing=true;
      const n=new Date().toLocaleString('es-ES');
      fbRef.set(realData).then(()=>{
        fbMetaRef.set({lastUser:curUser||'anon',ts:n});
        fbSyncing=false;
        document.getElementById('lastUpdate').textContent='‚òÅÔ∏è '+n;
      }).catch(e=>{fbSyncing=false;});
    }
  },800);
}
function f(v,fmt){if(v==null||v==='')return'‚Äî';const n=parseFloat(v);if(isNaN(n))return'‚Äî';if(fmt==='int')return Math.round(n).toLocaleString('es-ES');if(fmt==='dec')return n.toFixed(1);if(fmt==='eur')return'‚Ç¨'+n.toFixed(2);if(fmt==='eurInt')return'‚Ç¨'+Math.round(n).toLocaleString('es-ES');if(fmt==='pct')return(n*100).toFixed(1)+'%';return n.toFixed(1);}
function fd(v,fmt){if(v==null)return'‚Äî';return(v>0?'+':'')+f(v,fmt);}function fp(v){if(v==null)return'‚Äî';return(v>0?'+':'')+(v*100).toFixed(1)+'%';}function dc(v){return v==null?'delta-none':(v>=0?'delta-pos':'delta-neg');}
function dcPct(pct){if(pct==null)return'delta-none';if(pct>=0)return'delta-pos';if(pct>-0.10)return'delta-warn';return'delta-neg';}
function sitClsPct(pct){if(pct==null)return'sit-na';if(pct>=0)return'sit-ok';if(pct>-0.10)return'sit-warn';return'sit-bad';}
function sitAnswer(pct){if(pct==null)return'Sin datos';if(pct>=0)return'S√ç';return'NO';}
function switchTab(tab){curTab=tab;document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));document.querySelector('.tab.t-'+tab).classList.add('active');document.querySelectorAll('.tab-page').forEach(p=>p.classList.remove('active'));document.getElementById('page_'+tab).classList.add('active');render();}
function switchAESub(sub){curAESub=sub;render();}
function initSelect(){const s=document.getElementById('monthSelect');MONTHS.forEach((m,i)=>{const o=document.createElement('option');o.value=i;o.textContent=m;s.appendChild(o);});s.value=curMonth;s.onchange=e=>{curMonth=parseInt(e.target.value);render();};}
function renderSummaryCards(items){return items.map(k=>{const mg=k.magic,rl=k.real,d=rl!=null?rl-mg:null,p=(d!=null&&mg)?d/mg:null;const cls=d==null?'':(p>=0?'ok':(p>-0.10?'':'alert'));return`<div class="s-card ${cls}"><div class="label">${k.label}</div><div class="value ${rl==null?'empty':''}">${rl!=null?f(rl,k.fmt):'‚Äî'}</div><div class="sub">Obj: ${f(mg,k.fmt)}</div><div class="delta ${dcPct(p)}">${p!=null?fp(p):'Sin datos'}</div></div>`;}).join('');}
function renderKpiBlock(kpi,mi){const mg=kpi.magicVal,rl=gv(kpi.id,mi);const vn=(mg!=null&&rl!=null)?rl-mg:null,vp=(vn!=null&&mg)?vn/mg:null;let iv='';if(rl!=null){if(rl===0&&kpi.fmt!=='pct')iv='-';else iv=kpi.fmt==='pct'?(rl*100).toFixed(1):rl;}const ph=kpi.fmt==='eur'?'ej: 130':kpi.fmt==='pct'?'ej: 35.2':'valor (o -)';let h=`<tr class="r-magic"><td>${kpi.name}</td><td>MAGIC BALL</td><td>${f(mg,kpi.fmt)}</td></tr>`;h+=`<tr class="r-real"><td></td><td>REAL</td><td><input value="${iv}" placeholder="${ph}" onchange="hi('${kpi.id}',${mi},this.value,'${kpi.fmt}')" onfocus="this.select()"/></td></tr>`;h+=`<tr class="r-var"><td></td><td>Var. Nominal</td><td class="${dc(vn)}">${vn!=null?fd(vn,kpi.fmt):'‚Äî'}</td></tr>`;h+=`<tr class="r-var"><td></td><td>Var. %</td><td class="${dc(vp)}">${vp!=null?fp(vp):'‚Äî'}</td></tr>`;return h;}
function renderAutoRatio(label,mqlId,sqlId,magicRate,mi){const mR=gv(mqlId,mi),sR=gv(sqlId,mi);const realR=(mR!=null&&sR!=null&&mR!=0)?sR/mR:null;const vn=realR!=null?realR-magicRate:null,vp=(vn!=null&&magicRate)?vn/magicRate:null;let h=`<tr class="r-magic"><td>${label}</td><td>MAGIC BALL</td><td>${f(magicRate,'pct')}</td></tr>`;h+=`<tr class="r-auto"><td></td><td>AUTO-CALC</td><td>${realR!=null?f(realR,'pct'):'Introduce datos'}</td></tr>`;h+=`<tr class="r-var"><td></td><td>Var. Nominal</td><td class="${dc(vn)}">${vn!=null?fd(vn,'pct'):'‚Äî'}</td></tr>`;h+=`<tr class="r-var"><td></td><td>Var. %</td><td class="${dc(vp)}">${vp!=null?fp(vp):'‚Äî'}</td></tr>`;return h;}
function renderPersonCards(data,isObj){const entries=isObj?Object.entries(data):data.map(m=>[m.name,m]);const active=entries.filter(([,v])=>isActive(v.lastAct)),inactive=entries.filter(([,v])=>!isActive(v.lastAct));const avgAct=active.length?(active.reduce((s,[,v])=>s+v.avg_act,0)/active.length).toFixed(1):'‚Äî';let h='<div class="card-grid">';active.forEach(([name,d])=>{h+=`<div class="p-card"><div class="p-name">${name}<span class="tag ok">ACTIVO</span></div><div class="p-stat"><span class="lbl">SQLs</span><span class="val">${d.sqls}</span></div><div class="p-stat"><span class="lbl">Act/SQL (media)</span><span class="val">${d.avg_act}</span></div><div class="p-stat"><span class="lbl">${d.avg_cont!=null?'Contactos/SQL':'Notas/SQL'}</span><span class="val">${d.avg_cont??d.avg_notes}</span></div></div>`;});inactive.forEach(([name,d])=>{h+=`<div class="p-card inactive"><div class="p-name">${name}<span class="tag">INACTIVO 5+ DIAS</span></div><div class="p-stat"><span class="lbl">SQLs</span><span class="val">${d.sqls}</span></div><div class="p-stat"><span class="lbl">Ultima actividad</span><span class="val">${d.lastAct}</span></div></div>`;});h+='</div>';h+=`<div class="team-footer">Media equipo (solo activos): <span>${avgAct} act/SQL</span> ¬∑ Activos: <span>${active.length}/${entries.length}</span></div>`;return h;}
function renderTeamActivity(teamKey,teamLabel){const d=TEAM_ACT[teamKey];if(!d)return'';const pct=d.hist>0?((d.month/d.hist)-1):0;const above=pct>=0;const barW=Math.min(100,Math.abs(d.month/d.hist)*100);const icon=above?'üìà':'üìâ';return`<div class="team-act-card"><div class="act-icon">${icon}</div><div class="act-data"><div class="act-col"><div class="act-label">Media 6 meses</div><div class="act-value hist">${d.hist}</div><div class="act-hint">act/deal historico</div></div><div class="act-col"><div class="act-label">Este mes</div><div class="act-value curr">${d.month}</div><div class="act-bar"><div class="act-bar-fill ${above?'above':'below'}" style="width:${barW}%"></div></div></div><div class="act-col"><div class="act-label">Variaci√≥n</div><div class="act-delta ${above?'delta-pos':'delta-neg'}">${pct>=0?'+':''}${(pct*100).toFixed(0)}%</div><div class="act-hint">${above?'Trabajando M√ÅS que de costumbre':'Trabajando MENOS que de costumbre'}</div></div></div></div>`;}
function renderPressureCard(mi){const p=SDR_PRESSURE.sdr_in;if(!p)return'';const sdrsReal=gv('sdrs_in',mi);const sdrs=sdrsReal!=null?sdrsReal:MI.sdrs_in[mi];const de=calDaysElapsed(mi),dm=calDaysInMonth(mi);const projDeals=dm>0&&de>0?Math.round(p.curr_deals*(dm/de)):p.curr_deals;const currMqls=sdrs>0?Math.round(projDeals/sdrs):0;const pct=p.hist_avg>0?((currMqls/p.hist_avg)-1):0;const above=pct>=0;let h='<div class="team-act-card" style="border-color:var(--pink)"><div class="act-icon">'+(above?'üî•':'‚úÖ')+'</div><div class="act-data"><div class="act-col"><div class="act-label">Media 5 meses</div><div class="act-value hist">'+Math.round(p.hist_avg)+'</div><div class="act-hint">MQLs/SDR al mes</div></div><div class="act-col"><div class="act-label">Este mes (proy.)</div><div class="act-value curr">'+currMqls+'</div><div class="act-bar"><div class="act-bar-fill '+(above?'above':'below')+'" style="width:'+Math.min(100,Math.abs(currMqls/p.hist_avg)*100)+'%"></div></div></div><div class="act-col"><div class="act-label">Variaci√≥n</div><div class="act-delta '+(above?'delta-neg':'delta-pos')+'">'+(pct>=0?'+':'')+Math.round(pct*100)+'%</div><div class="act-hint">'+(above?'SDRs m√°s PRESIONADOS que de costumbre':'Carga por SDR controlada')+'</div></div></div>';h+='<div style="margin-top:8px;font-size:9px;color:var(--dim);line-height:1.5">Deals creados Feb: <b>'+p.curr_deals+'</b> (a d√≠a '+de+'/'+dm+') ¬∑ Proyecci√≥n: <b>'+projDeals+'</b> ¬∑ SDRs: <b>'+sdrs+'</b>';h+='<br>Hist√≥rico: ';p.months.forEach(m=>{h+=m.m+': '+m.deals+' deals/'+m.sdrs+' SDRs = '+Math.round(m.mqls)+' ¬∑ ';});h+='</div></div>';return h;}
function renderDeviation(effects,totDev,mrrMagic,hasData){if(!hasData)return'<div class="no-data-msg">Introduce datos reales para generar el diagnostico</div>';let h='<div class="dev-summary"><div class="dev-block"><h4>% Responsabilidad sobre la desviacion</h4>';effects.filter(e=>e.val!=null).forEach(e=>{const bw=Math.min(Math.abs(e.pct||0)*100,100),bc=e.val>=0?'pos':'neg';h+=`<div class="dev-row"><span class="lbl">${e.lbl}</span><div class="dev-bar"><div class="dev-bar-fill ${bc}" style="width:${bw}%"></div></div><span class="pct ${dc(e.pct)}">${(Math.abs(e.pct)*100).toFixed(1)}%</span></div>`;});const ts=totDev>=0?'+':'';h+=`<div class="dev-total"><span class="lbl">Desviacion total estimada</span><span class="val ${dc(totDev)}">${ts}‚Ç¨${Math.round(Math.abs(totDev)).toLocaleString('es-ES')}</span></div></div>`;h+='<div class="dev-block"><h4>Impacto en MRR por variable</h4>';const sorted=[...effects].filter(e=>e.val!=null).sort((a,b)=>a.val-b.val);sorted.forEach(e=>{const s2=e.val>=0?'+':'';h+=`<div class="dev-row"><span class="lbl">${e.lbl}</span><span class="eur ${dc(e.val)}">${s2}‚Ç¨${Math.round(Math.abs(e.val)).toLocaleString('es-ES')}</span><span class="pct ${dc(e.val)}" style="font-size:9px">${e.val>=0?'‚ñ≤':'‚ñº'} ${(Math.abs(e.pct)*100).toFixed(0)}%</span></div>`;});const neg=sorted.filter(e=>e.val<0);if(neg.length>0){h+='<div style="margin-top:12px;padding-top:10px;border-top:1px solid var(--brd);font-size:10px;color:var(--dim);line-height:1.7"><span style="color:var(--pink);font-weight:700">DIAGNOSTICO:</span> ';if(totDev<0){h+=`Estamos <span style="color:var(--red);font-weight:700">${fp(totDev/mrrMagic)}</span> por debajo. Principal causa: <span style="color:var(--cyan);font-weight:700">${neg[0].lbl}</span> (${Math.abs(neg[0].pct*100).toFixed(0)}%).`;}else{h+=`Estamos <span style="color:var(--grn);font-weight:700">${fp(totDev/mrrMagic)}</span> por ENCIMA.`;}h+='</div>';}h+='</div></div>';return h;}
function sec(id,icon,title,color,content,startOpen=true){return`<div class="section"><div class="sec-head ${color} ${startOpen?'expanded':''}" onclick="tog('${id}')"><span class="icon">${icon}</span><span class="title">${title}</span><span class="toggle ${startOpen?'open':''}" id="tog_${id}">‚ñæ</span></div><div class="sec-body ${startOpen?'open':''}" id="sb_${id}">${content}</div></div>`;}
function sitCard(q,val,diff,diffPct,fmt){const cls=sitClsPct(diffPct);const ans=sitAnswer(diffPct);const valColor=dcPct(diffPct);return`<div class="sit-card ${cls}"><div class="sit-q">${q}</div><div class="sit-answer" style="color:${diffPct==null?'var(--mut)':(diffPct>=0?'var(--grn)':(diffPct>-0.10?'var(--org)':'var(--red)'))}">${ans}</div><div class="sit-detail">${val!=null?`Actual: <b>${f(val,fmt)}</b> ¬∑ ${diff!=null?`<b>${diff>0?'+':''}${f(diff,fmt)}</b> vs obj ¬∑ <b class="${valColor}">${fp(diffPct)}</b>`:''}`:'Introduce datos reales'}</div></div>`;}
function sitNarr(area,teamKey,items){const filled=items.filter(i=>i.val!=null);if(!filled.length)return`<div class="sit-general"><div class="sit-title">RESUMEN ‚Äî ${area}</div>Introduce datos reales.</div>`;const good=filled.filter(i=>i.ok).length;let m=`<div class="sit-general"><div class="sit-title">RESUMEN ‚Äî ${area}</div>`;if(good===filled.length)m+='<span style="color:var(--grn);font-weight:700">‚úÖ Todos los indicadores en verde.</span>';else if(good===0)m+='<span style="color:var(--red);font-weight:700">üö® Todos los indicadores bajo objetivo.</span>';else m+=`<span style="color:var(--org);font-weight:700">‚ö†Ô∏è ${good}/${filled.length} indicadores en objetivo.</span>`;m+='<div style="margin-top:10px;line-height:1.8;font-size:11px">';const trab=filled.find(i=>i.q==='Trabajo');const opps=filled.find(i=>['MQLs','SQLs'].includes(i.q));const arpa=filled.find(i=>i.q==='ARPA');const ratio=filled.find(i=>['Ratio','Rate'].includes(i.q));const mrr=filled.find(i=>i.q==='MRR');const act=teamKey&&TEAM_ACT[teamKey]?TEAM_ACT[teamKey]:null;const narr=[];if(act){const actPct=act.hist>0?((act.month/act.hist)-1):0;if(actPct<-0.1)narr.push(`<span style="color:var(--red)">üìâ ACTIVIDAD:</span> El equipo est√° haciendo <b>${Math.abs(actPct*100).toFixed(0)}% MENOS actividades</b> por lead que la media de 6 meses (${act.month} vs ${act.hist} act/lead). Esto puede indicar menor intensidad de trabajo o cambio de enfoque.`);else if(actPct>0.1)narr.push(`<span style="color:var(--grn)">üìà ACTIVIDAD:</span> El equipo est√° haciendo <b>${Math.abs(actPct*100).toFixed(0)}% M√ÅS actividades</b> por lead que la media de 6 meses (${act.month} vs ${act.hist} act/lead). Esfuerzo por encima de lo habitual.`);else narr.push(`<span style="color:var(--cyan)">üìä ACTIVIDAD:</span> El ritmo de trabajo se mantiene en l√≠nea con la media hist√≥rica (${act.month} vs ${act.hist} act/lead).`);}if(opps){if(opps.pct<-0.15)narr.push(`<span style="color:var(--red)">‚¨áÔ∏è OPORTUNIDADES:</span> Se reciben <b>${Math.abs(opps.pct*100).toFixed(0)}% MENOS ${opps.q}</b> de lo previsto (${f(opps.val,opps.fmt)} vs obj ${f(opps.val-opps.diff,opps.fmt)}). Esto reduce el pipeline disponible.`);else if(opps.pct>0.15)narr.push(`<span style="color:var(--grn)">‚¨ÜÔ∏è OPORTUNIDADES:</span> Se reciben <b>${Math.abs(opps.pct*100).toFixed(0)}% M√ÅS ${opps.q}</b> de lo esperado (${f(opps.val,opps.fmt)} vs obj ${f(opps.val-opps.diff,opps.fmt)}). Buen volumen de entrada.`);else if(opps.pct!=null)narr.push(`<span style="color:var(--cyan)">‚ÜîÔ∏è OPORTUNIDADES:</span> El volumen de ${opps.q} est√° en l√≠nea con lo esperado (${fp(opps.pct)}).`);}if(ratio){if(ratio.pct<-0.1)narr.push(`<span style="color:var(--red)">‚¨áÔ∏è RATIO:</span> El ratio de conversi√≥n est√° <b>${Math.abs(ratio.pct*100).toFixed(0)}% por debajo</b> (${f(ratio.val,ratio.fmt)} vs obj ${f(ratio.val-ratio.diff,ratio.fmt)}). Se cierran menos deals de lo esperado.`);else if(ratio.pct>0.1)narr.push(`<span style="color:var(--grn)">‚¨ÜÔ∏è RATIO:</span> El ratio de conversi√≥n est√° <b>${Math.abs(ratio.pct*100).toFixed(0)}% por encima</b> (${f(ratio.val,ratio.fmt)} vs obj ${f(ratio.val-ratio.diff,ratio.fmt)}). Buena efectividad de cierre.`);else if(ratio.pct!=null)narr.push(`<span style="color:var(--cyan)">‚ÜîÔ∏è RATIO:</span> El ratio de conversi√≥n est√° en l√≠nea con lo esperado (${fp(ratio.pct)}).`);}if(arpa){if(arpa.pct<-0.1)narr.push(`<span style="color:var(--red)">‚¨áÔ∏è ARPA:</span> El ticket medio est√° <b>${Math.abs(arpa.pct*100).toFixed(0)}% por debajo</b> (${f(arpa.val,arpa.fmt)} vs obj ${f(arpa.val-arpa.diff,arpa.fmt)}). Se vende a menor precio de lo planificado.`);else if(arpa.pct>0.1)narr.push(`<span style="color:var(--grn)">‚¨ÜÔ∏è ARPA:</span> El ticket medio est√° <b>${Math.abs(arpa.pct*100).toFixed(0)}% por encima</b> (${f(arpa.val,arpa.fmt)} vs obj ${f(arpa.val-arpa.diff,arpa.fmt)}). Se vende a mayor precio.`);else if(arpa.pct!=null)narr.push(`<span style="color:var(--cyan)">‚ÜîÔ∏è ARPA:</span> El ticket medio est√° en l√≠nea con lo esperado (${fp(arpa.pct)}).`);}if(mrr){if(mrr.pct<-0.1)narr.push(`<span style="color:var(--red)">‚¨áÔ∏è MRR:</span> El MRR total est√° <b>${Math.abs(mrr.pct*100).toFixed(0)}% por debajo</b> del objetivo.`);else if(mrr.pct>0.1)narr.push(`<span style="color:var(--grn)">‚¨ÜÔ∏è MRR:</span> El MRR total est√° <b>${Math.abs(mrr.pct*100).toFixed(0)}% por encima</b> del objetivo.`);}const causal=[];if(act&&opps){const actUp=act.month>act.hist*1.05;const actDn=act.month<act.hist*0.95;const oppUp=opps.pct>0.1;const oppDn=opps.pct<-0.1;if(oppDn&&actUp)causal.push('Como se reciben <b>menos oportunidades</b> de lo previsto, el equipo est√° compensando <b>aumentando la intensidad de trabajo</b> por lead.');if(oppDn&&actDn)causal.push('Se reciben <b>menos oportunidades</b> y adem√°s el equipo est√° haciendo <b>menos actividades</b> por lead ‚Äî doble se√±al de alerta.');if(oppUp&&actDn)causal.push('A pesar de recibir <b>m√°s oportunidades</b>, el equipo est√° haciendo <b>menos actividades</b> por lead ‚Äî posible sobrecarga.');if(oppUp&&actUp)causal.push('M√°s oportunidades y m√°s actividades por lead ‚Äî el equipo est√° en <b>modo m√°ximo rendimiento</b>.');}if(act&&ratio){const actUp=act.month>act.hist*1.05;const ratUp=ratio&&ratio.pct>0.05;const ratDn=ratio&&ratio.pct<-0.05;if(actUp&&ratUp)causal.push('El mayor esfuerzo en actividades est√° repercutiendo <b>positivamente en el ratio de cierre</b>.');if(actUp&&ratDn)causal.push('A pesar del mayor esfuerzo, el <b>ratio de cierre no mejora</b> ‚Äî revisar calidad de las oportunidades.');if(actUp&&arpa&&arpa.pct<-0.05)causal.push('El aumento de actividades podr√≠a estar llevando a cerrar deals de <b>menor valor (ARPA baja)</b> para compensar volumen.');}if(ratio&&arpa){const ratUp=ratio.pct>0.05;const ratDn=ratio.pct<-0.05;const arpaUp=arpa.pct>0.05;const arpaDn=arpa.pct<-0.05;if(ratUp&&arpaDn)causal.push('Se cierran m√°s deals pero a <b>menor precio</b> ‚Äî el equipo prioriza volumen sobre valor.');if(ratDn&&arpaUp)causal.push('Se cierran menos deals pero a <b>mayor precio</b> ‚Äî el equipo est√° siendo m√°s selectivo.');}if(teamKey==='sdr_in'&&SDR_PRESSURE&&SDR_PRESSURE.sdr_in){const pr=SDR_PRESSURE.sdr_in;const sdrsR=gv('sdrs_in',curMonth);const sdrs=sdrsR!=null?sdrsR:MI.sdrs_in[curMonth];const de=calDaysElapsed(curMonth),dm=calDaysInMonth(curMonth);const projD=dm>0&&de>0?Math.round(pr.curr_deals*(dm/de)):pr.curr_deals;const cMqls=sdrs>0?Math.round(projD/sdrs):0;const pPct=pr.hist_avg>0?((cMqls/pr.hist_avg)-1):0;if(pPct>0.1)narr.push(`<span style="color:var(--red)">üî• PRESI√ìN:</span> Los SDRs est√°n recibiendo <b>${Math.abs(Math.round(pPct*100))}% M√ÅS MQLs por persona</b> que la media hist√≥rica (${cMqls} vs ${Math.round(pr.hist_avg)} MQLs/SDR). ${act&&act.month<act.hist*0.95?'Combinado con menor actividad por lead, esto sugiere <b>saturaci√≥n del equipo</b>.':'El equipo podr√≠a estar acerc√°ndose al <b>l√≠mite de capacidad</b>.'}`);else if(pPct<-0.1)narr.push(`<span style="color:var(--grn)">üìâ PRESI√ìN:</span> Los SDRs est√°n recibiendo <b>${Math.abs(Math.round(pPct*100))}% MENOS MQLs por persona</b> (${cMqls} vs ${Math.round(pr.hist_avg)} MQLs/SDR). Menor carga, hay margen para mejorar calidad de trabajo.`);else narr.push(`<span style="color:var(--cyan)">üìä PRESI√ìN:</span> La carga de MQLs por SDR est√° en l√≠nea con la media hist√≥rica (${cMqls} vs ${Math.round(pr.hist_avg)} MQLs/SDR).`);}
if(causal.length){narr.push('<br><span style="color:var(--pink);font-weight:700">üîó INTERACCI√ìN DE VARIABLES:</span>');causal.forEach(c=>narr.push(c));}narr.forEach(n=>{m+=`<br>‚Ä¢ ${n}`;});m+='</div></div>';return m;}
function renderSit(tab,mi){let h='';
if(tab==='inbound'){const sA=filterActiveObj(SDR_IN);const aA=Object.values(sA).length?Object.values(sA).reduce((s,v)=>s+v.avg_act,0)/Object.values(sA).length:null;const actT=TEAM_ACT.sdr_in;const allA=actT?actT.hist:7.9;const aD=aA?aA-allA:null;const aP=aD?aD/allA:null;const mP=gv('mqls_paid',mi),mI=gv('mqls_inbound',mi);const mM=MI.mqls_paid[mi]+MI.mqls_inbound[mi];const mR=(mP!=null||mI!=null)?(mP||0)+(mI||0):null;const mD=mR!=null?mR-mM:null;const mPt=mD!=null?mD/mM:null;const inV=gv('ventas_in',mi);const inMrrR=gv('direct_mrr',mi);const sqP=gv('sqls_paid',mi),sqI=gv('sqls_inbound',mi);const inSqlT=(sqP!=null||sqI!=null)?(sqP||0)+(sqI||0):null;const aM=(MI.arpa_paid[mi]+MI.arpa_inbound[mi])/2;const aR2=(inV!=null&&inV>0&&inMrrR!=null)?inMrrR/inV:null;const aD2=aR2!=null?aR2-aM:null;const aPt2=aD2!=null?aD2/aM:null;const rM=(MI.rate_paid[mi]+MI.rate_inbound[mi])/2;const rR=(inV!=null&&inSqlT!=null&&inSqlT>0)?inV/inSqlT:null;const rD=rR!=null?rR-rM:null;const rPt=rD!=null?rD/rM:null;h+='<div class="sit-grid">';h+=sitCard('¬øEstamos TRABAJANDO lo suficiente?',aA,aD,aP,'dec');h+=sitCard('¬øRecibimos suficientes OPORTUNIDADES?',mR,mD,mPt,'int');h+=sitCard('¬øVendemos al PRECIO suficiente?',aR2,aD2,aPt2,'eur');h+=sitCard('¬øCERRAMOS suficientes deals?',rR,rD,rPt,'pct');h+='</div>';h+=sitNarr('Inbound','sdr_in',[{q:'Trabajo',ok:aD>=0,val:aA,diff:aD,pct:aP,fmt:'dec'},{q:'MQLs',ok:mD>=0,val:mR,diff:mD,pct:mPt,fmt:'int'},{q:'ARPA',ok:aD2!=null&&aD2>=0,val:aR2,diff:aD2,pct:aPt2,fmt:'eur'},{q:'Ratio',ok:rD!=null&&rD>=0,val:rR,diff:rD,pct:rPt,fmt:'pct'}]);}
else if(tab==='outbound'){const sA=filterActiveObj(SDR_OUT);const aA=Object.values(sA).length?Object.values(sA).reduce((s,v)=>s+v.avg_act,0)/Object.values(sA).length:null;const actT=TEAM_ACT.sdr_out;const allA=actT?actT.hist:5.2;const aD=aA?aA-allA:null;const aP=aD?aD/allA:null;const sR=gv('sqls_out',mi);const sD=sR!=null?sR-MO.sqls_out[mi]:null;const sPt=sD!=null?sD/MO.sqls_out[mi]:null;const aR=gv('arpa_out',mi);const arD=aR!=null?aR-MO.arpa_out[mi]:null;const arP=arD!=null?arD/MO.arpa_out[mi]:null;const rR=gv('rate_hql_out',mi);const rD=rR!=null?rR-MO.rate_sql_hql[mi]:null;const rP=rD!=null?rD/MO.rate_sql_hql[mi]:null;h+='<div class="sit-grid">';h+=sitCard('¬øEstamos TRABAJANDO lo suficiente?',aA,aD,aP,'dec');h+=sitCard('¬øRecibimos oportunidades?',sR,sD,sPt,'int');h+=sitCard('¬øVendemos al precio suficiente?',aR,arD,arP,'eur');h+=sitCard('¬øCerramos suficientes deals?',rR,rD,rP,'pct');h+='</div>';h+=sitNarr('Outbound','sdr_out',[{q:'Trabajo',ok:aD>=0,val:aA,diff:aD,pct:aP,fmt:'dec'},{q:'SQLs',ok:sD!=null&&sD>=0,val:sR,diff:sD,pct:sPt,fmt:'int'},{q:'ARPA',ok:arD!=null&&arD>=0,val:aR,diff:arD,pct:arP,fmt:'eur'},{q:'Ratio',ok:rD!=null&&rD>=0,val:rR,diff:rD,pct:rP,fmt:'pct'}]);}
else if(tab==='ae'){const allAE=AE_TEAMS.flatMap(t=>t.members);const actAE=filterActive(allAE);const aA=actAE.length?actAE.reduce((s,m)=>s+m.avg_act,0)/actAE.length:null;const actT=TEAM_ACT.ae_total;const allA=actT?actT.hist:12;const aD=aA?aA-allA:null;const aP=aD?aD/allA:null;const sR=getTeamSqlsRealSum(mi)||gv('ae_sqls',mi);const sD=sR!=null?sR-MA.sqls[mi]:null;const sPt=sD!=null?sD/MA.sqls[mi]:null;const aeV=getTeamVentasSum(mi);const aeMrrT=getTeamMrrRealSum(mi);const aR=(aeV!=null&&aeV>0&&aeMrrT!=null)?aeMrrT/aeV:null;const arD=aR!=null?aR-MA.arpa[mi]:null;const arP=arD!=null?arD/MA.arpa[mi]:null;const avgMR=(MA.rate_in[mi]+MA.rate_out[mi])/2;const avgR=(aeV!=null&&sR!=null&&sR>0)?aeV/sR:null;const rD=avgR!=null?avgR-avgMR:null;const rP=rD!=null?rD/avgMR:null;h+='<div class="sit-grid">';h+=sitCard('¬øEstamos TRABAJANDO lo suficiente?',aA,aD,aP,'dec');h+=sitCard('¬øRecibimos suficientes OPORTUNIDADES?',sR,sD,sPt,'int');h+=sitCard('¬øVendemos al PRECIO suficiente?',aR,arD,arP,'eur');h+=sitCard('¬øCERRAMOS suficientes deals?',avgR,rD,rP,'pct');h+='</div>';h+=sitNarr('AE','ae_total',[{q:'Trabajo',ok:aD>=0||aD==null,val:aA,diff:aD,pct:aP,fmt:'dec'},{q:'SQLs',ok:sD!=null&&sD>=0,val:sR,diff:sD,pct:sPt,fmt:'int'},{q:'ARPA',ok:arD!=null&&arD>=0,val:aR,diff:arD,pct:arP,fmt:'eur'},{q:'Rate',ok:rD!=null&&rD>=0,val:avgR,diff:rD,pct:rP,fmt:'pct'}]);}
return h;}
function decompInbound(mi){const rv=id=>gv(id,mi);const mp=rv('mqls_paid'),sp=rv('sqls_paid'),ap=rv('arpa_paid'),m2=rv('mqls_inbound'),si=rv('sqls_inbound'),ai=rv('arpa_inbound');const eff=[{lbl:'MQLs Paid',val:mp!=null?(mp-MI.mqls_paid[mi])*MI.rate_paid[mi]*MI.arpa_paid[mi]:null},{lbl:'Ratio Paid',val:(sp!=null&&mp!=null&&mp!=0)?MI.mqls_paid[mi]*(sp/mp-MI.rate_paid[mi])*MI.arpa_paid[mi]:null},{lbl:'ARPA Paid',val:ap!=null?MI.mqls_paid[mi]*MI.rate_paid[mi]*(ap-MI.arpa_paid[mi]):null},{lbl:'MQLs Inbound',val:m2!=null?(m2-MI.mqls_inbound[mi])*MI.rate_inbound[mi]*MI.arpa_inbound[mi]:null},{lbl:'Ratio Inbound',val:(si!=null&&m2!=null&&m2!=0)?MI.mqls_inbound[mi]*(si/m2-MI.rate_inbound[mi])*MI.arpa_inbound[mi]:null},{lbl:'ARPA Inbound',val:ai!=null?MI.mqls_inbound[mi]*MI.rate_inbound[mi]*(ai-MI.arpa_inbound[mi]):null}];const ta=eff.reduce((s,e)=>s+(e.val!=null?Math.abs(e.val):0),0);eff.forEach(e=>{e.pct=(e.val!=null&&ta>0)?e.val/ta:null;});return{effects:eff,totDev:eff.reduce((s,e)=>s+(e.val||0),0),hasData:eff.some(e=>e.val!=null)};}
function decompOutbound(mi){const rv=id=>gv(id,mi);const sq=rv('sqls_out'),rh=rv('rate_hql_out'),ar=rv('arpa_out');const eff=[{lbl:'Nro SQLs',val:sq!=null?(sq-MO.sqls_out[mi])*MO.conv_client[mi]*MO.arpa_out[mi]:null},{lbl:'Conv SQL-HQL',val:rh!=null?MO.sqls_out[mi]*(rh-MO.rate_sql_hql[mi])*MO.conv_client[mi]*MO.arpa_out[mi]/MO.rate_sql_hql[mi]:null},{lbl:'ARPA Out',val:ar!=null?MO.sqls_out[mi]*MO.conv_client[mi]*(ar-MO.arpa_out[mi]):null}];const ta=eff.reduce((s,e)=>s+(e.val!=null?Math.abs(e.val):0),0);eff.forEach(e=>{e.pct=(e.val!=null&&ta>0)?e.val/ta:null;});return{effects:eff,totDev:eff.reduce((s,e)=>s+(e.val||0),0),hasData:eff.some(e=>e.val!=null)};}
function decompAE(mi){const rv=id=>gv(id,mi);const sq=rv('ae_sqls'),ven=getTeamVentasSum(mi),mrrT=getTeamMrrRealSum(mi);const ar=(ven!=null&&ven>0&&mrrT!=null)?mrrT/ven:null;const ratioM=(MA.rate_in[mi]+MA.rate_out[mi])/2;const ratioR=(ven!=null&&sq!=null&&sq>0)?ven/sq:null;const eff=[{lbl:'Nro SQLs (Oportunidades)',val:sq!=null?(sq-MA.sqls[mi])*ratioM*MA.arpa[mi]:null},{lbl:'Ratio Conversi√≥n',val:ratioR!=null?MA.sqls[mi]*(ratioR-ratioM)*MA.arpa[mi]:null},{lbl:'ARPA',val:ar!=null?MA.sqls[mi]*ratioM*(ar-MA.arpa[mi]):null}];const ta=eff.reduce((s,e)=>s+(e.val!=null?Math.abs(e.val):0),0);eff.forEach(e=>{e.pct=(e.val!=null&&ta>0)?e.val/ta:null;});return{effects:eff,totDev:eff.reduce((s,e)=>s+(e.val||0),0),hasData:eff.some(e=>e.val!=null)};}
function getTeamAccountsSum(mi){let sum=0,has=false;AE_TEAMS.forEach(t=>{const v=gv('ae_'+t.id+'_aes_activos',mi);if(v!=null){sum+=v;has=true;}});return has?sum:null;}
function getTeamSqlsProjSum(mi){let sum=0,allFilled=true;AE_TEAMS.forEach(t=>{const aes=gv('ae_'+t.id+'_aes_activos',mi);const sp=gv('ae_'+t.id+'_sqls_persona',mi);if(aes!=null&&sp!=null){sum+=Math.round(aes*sp);}else{allFilled=false;}});return{sum:sum,allFilled:allFilled,hasAny:sum>0};}
function getTeamSqlsProjDetail(mi){return AE_TEAMS.map(t=>{const aes=gv('ae_'+t.id+'_aes_activos',mi);const sp=gv('ae_'+t.id+'_sqls_persona',mi);return{id:t.id,name:t.name,aes:aes,sqlsPer:sp,proj:(aes!=null&&sp!=null)?Math.round(aes*sp):null};});}
function getTeamMrrObjSum(mi){let sum=0,allFilled=true;AE_TEAMS.forEach(t=>{const v=gv('ae_'+t.id+'_mrr_obj',mi);if(v!=null){sum+=v;}else{allFilled=false;}});return{sum:sum,allFilled:allFilled,hasAny:sum>0};}
function getTeamMrrRealSum(mi){let sum=0,has=false;AE_TEAMS.forEach(t=>{const v=gv('ae_'+t.id+'_mrr_real',mi);if(v!=null){sum+=v;has=true;}});return has?sum:null;}
function getTeamSqlsRealSum(mi){let sum=0,has=false;AE_TEAMS.forEach(t=>{const v=gv('ae_'+t.id+'_sqls',mi);if(v!=null){sum+=v;has=true;}});return has?sum:null;}
function getTeamVentasSum(mi){let sum=0,has=false;AE_TEAMS.forEach(t=>{const v=gv('ae_'+t.id+'_ventas',mi);if(v!=null){sum+=v;has=true;}});return has?sum:null;}
function getTeamVentasDetail(mi){return AE_TEAMS.map(t=>{const v=gv('ae_'+t.id+'_ventas',mi);return{id:t.id,name:t.name,houseName:t.houseName,ventas:v};});}
function getTeamMrrDetail(mi){return AE_TEAMS.map(t=>{const obj=gv('ae_'+t.id+'_mrr_obj',mi);const real=gv('ae_'+t.id+'_mrr_real',mi);return{id:t.id,name:t.name,houseName:t.houseName,obj:obj,real:real};});}
function render(){const mi=curMonth;if(curTab==='inbound')renderInbound(mi);else if(curTab==='outbound')renderOutbound(mi);else if(curTab==='ae')renderAE(mi);else if(curTab==='general')renderGeneral(mi);}
function renderInbound(mi){let h='<div class="tab-logo"><img src="'+CRESTS.inbound+'" alt="Inbound"/><div class="tab-title" style="color:var(--pink)">LOS LINCES RAVERS</div></div>';const cards=[{label:'DIRECT NEW MRR',magic:MI.direct_mrr[mi],real:gv('direct_mrr',mi),fmt:'eurInt'},{label:'MQLs PAID',magic:MI.mqls_paid[mi],real:gv('mqls_paid',mi),fmt:'int'},{label:'MQLs INBOUND',magic:MI.mqls_inbound[mi],real:gv('mqls_inbound',mi),fmt:'int'},{label:'SQLs PAID',magic:MI.sqls_paid[mi],real:gv('sqls_paid',mi),fmt:'int'},{label:'SQLs INBOUND',magic:MI.sqls_inbound[mi],real:gv('sqls_inbound',mi),fmt:'int'},{label:'SDRs ACTIVOS',magic:MI.sdrs_in[mi],real:gv('sdrs_in',mi),fmt:'int'}];h+='<div class="summary-grid">'+renderSummaryCards(cards)+'</div>';if(curView==='hoy'){h+=sec('i_pace','üìç','Progreso Hoy','purple','<div class="pace-grid">'+(gv('direct_mrr',mi)!=null?renderPaceProgressCard('DIRECT NEW MRR',gv('direct_mrr',mi),MI.direct_mrr[mi],mi):'')+(gv('mqls_paid',mi)!=null?renderPaceProgressCard('MQLs PAID',gv('mqls_paid',mi),MI.mqls_paid[mi],mi):'')+(gv('mqls_inbound',mi)!=null?renderPaceProgressCard('MQLs INBOUND',gv('mqls_inbound',mi),MI.mqls_inbound[mi],mi):'')+(gv('sqls_paid',mi)!=null?renderPaceProgressCard('SQLs PAID',gv('sqls_paid',mi),MI.sqls_paid[mi],mi):'')+(gv('sqls_inbound',mi)!=null?renderPaceProgressCard('SQLs INBOUND',gv('sqls_inbound',mi),MI.sqls_inbound[mi],mi):'')+'</div>',false);}else if(curView==='proj'){h+=sec('i_proj','üìà','Proyecci√≥n Cierre de Mes','purple','<div class="pace-grid">'+(gv('direct_mrr',mi)!=null?renderProjectionCard('DIRECT NEW MRR',gv('direct_mrr',mi),MI.direct_mrr[mi],mi):'')+(gv('mqls_paid',mi)!=null?renderProjectionCard('MQLs PAID',gv('mqls_paid',mi),MI.mqls_paid[mi],mi):'')+(gv('mqls_inbound',mi)!=null?renderProjectionCard('MQLs INBOUND',gv('mqls_inbound',mi),MI.mqls_inbound[mi],mi):'')+(gv('sqls_paid',mi)!=null?renderProjectionCard('SQLs PAID',gv('sqls_paid',mi),MI.sqls_paid[mi],mi):'')+(gv('sqls_inbound',mi)!=null?renderProjectionCard('SQLs INBOUND',gv('sqls_inbound',mi),MI.sqls_inbound[mi],mi):'')+'</div>',false);}h+=sec('i_sit','üìã','Lectura de la Situacion','green',renderSit('inbound',mi));h+=sec('i_act_team','üìä','Media Actividades Equipo Inbound (Hist√≥rico vs Este Mes)','pink',renderTeamActivity('sdr_in','SDR Inbound'));h+=sec('i_pressure','üî•','Presi√≥n MQLs/SDR (Hist√≥rico vs Este Mes)','pink',renderPressureCard(mi));h+=sec('i_sdr','üìä','Actividad SDRs Inbound por Persona (HubSpot)','pink',renderPersonCards(SDR_IN,true),false);let t='<table class="ktable">';t+=renderKpiBlock({id:'direct_mrr',name:'Direct New MRR',magicVal:MI.direct_mrr[mi],fmt:'eurInt'},mi);t+='</table>';h+=sec('i_mrr','üí∞','MRR','green',t);t='<table class="ktable">';t+=renderKpiBlock({id:'mqls_paid',name:'MQLs Paid',magicVal:MI.mqls_paid[mi],fmt:'int'},mi);t+=renderKpiBlock({id:'mqls_inbound',name:'MQLs Inbound',magicVal:MI.mqls_inbound[mi],fmt:'int'},mi);t+='</table>';h+=sec('i_mql','üéØ','MQLs','blue',t);t='<table class="ktable">';t+=renderKpiBlock({id:'sqls_paid',name:'SQLs Paid',magicVal:MI.sqls_paid[mi],fmt:'int'},mi);t+=renderKpiBlock({id:'sqls_inbound',name:'SQLs Inbound',magicVal:MI.sqls_inbound[mi],fmt:'int'},mi);t+='</table>';h+=sec('i_sql','üìû','SQLs','cyan',t);t='<table class="ktable">';t+=renderKpiBlock({id:'sdrs_in',name:'SDRs Activos Inbound',magicVal:MI.sdrs_in[mi],fmt:'int'},mi);t+='</table>';h+=sec('i_sdrs','üë•','SDRs Activos','pink',t);
const inVentas=gv('ventas_in',mi);const inMrr=gv('direct_mrr',mi);const inArpaComp=(inVentas!=null&&inVentas>0&&inMrr!=null)?inMrr/inVentas:null;
const inSqlsTotal=(gv('sqls_paid',mi)!=null&&gv('sqls_inbound',mi)!=null)?gv('sqls_paid',mi)+gv('sqls_inbound',mi):null;const inRatioComp=(inVentas!=null&&inSqlsTotal!=null&&inSqlsTotal>0)?inVentas/inSqlsTotal:null;
const inArpaMagic=(MI.arpa_paid[mi]+MI.arpa_inbound[mi])/2;const inRatioMagic=(MI.rate_paid[mi]+MI.rate_inbound[mi])/2;
if(inArpaComp!=null){sv('arpa_paid',mi,inArpaComp);sv('arpa_inbound',mi,inArpaComp);}
t='<table class="ktable">';t+=renderKpiBlock({id:'ventas_in',name:'Ventas Cerradas Inbound',magicVal:Math.round((MI.sqls_paid[mi]+MI.sqls_inbound[mi])*inRatioMagic),fmt:'int'},mi);
t+='<tr class="sep"><td colspan="3"></td></tr>';
t+='<tr class="r-magic"><td>ARPA Inbound (MRR/Ventas)</td><td>MAGIC BALL</td><td>'+f(inArpaMagic,'eur')+'</td></tr>';
if(inArpaComp!=null){const d=inArpaComp-inArpaMagic;const p=inArpaMagic>0?d/inArpaMagic:0;t+='<tr class="r-auto"><td></td><td>REAL (AUTO)</td><td class="'+dcPct(p)+'">'+f(inArpaComp,'eur')+'</td></tr>';t+='<tr class="r-var"><td></td><td>Var.</td><td class="'+dcPct(p)+'">'+f(d,'eur')+' ('+fp(p)+')</td></tr>';}
else{t+='<tr class="r-auto"><td></td><td>REAL (AUTO)</td><td>Introduce Ventas y MRR</td></tr>';}
t+='<tr class="sep"><td colspan="3"></td></tr>';
t+='<tr class="r-magic"><td>Ratio Conversi√≥n (Ventas/SQLs)</td><td>MAGIC BALL</td><td>'+fp(inRatioMagic)+'</td></tr>';
if(inRatioComp!=null){const d=inRatioComp-inRatioMagic;const p=inRatioMagic>0?d/inRatioMagic:0;t+='<tr class="r-auto"><td></td><td>REAL (AUTO)</td><td class="'+dcPct(p)+'">'+fp(inRatioComp)+'</td></tr>';t+='<tr class="r-var"><td></td><td>Var.</td><td class="'+dcPct(p)+'">'+fp(d)+' ('+fp(p)+')</td></tr>';}
else{t+='<tr class="r-auto"><td></td><td>REAL (AUTO)</td><td>Introduce Ventas y SQLs</td></tr>';}
t+='</table>';h+=sec('i_ventas','üèÜ','Ventas ¬∑ ARPA ¬∑ Ratio','green',t);
document.getElementById('ct_inbound').innerHTML=h;}
function renderOutbound(mi){let h='<div class="tab-logo"><img src="'+CRESTS.outbound+'" alt="Outbound"/><div class="tab-title" style="color:var(--org)">OUTBOUND PIRATES</div></div>';const mrrM=MO.new_mrr_out[mi];const cards=[{label:'NEW MRR OUTBOUND',magic:mrrM,real:gv('mrr_out',mi),fmt:'eurInt'},{label:'SQLs OUTBOUND',magic:MO.sqls_out[mi],real:gv('sqls_out',mi),fmt:'int'},{label:'ARPA OUTBOUND',magic:MO.arpa_out[mi],real:gv('arpa_out',mi),fmt:'eur'},{label:'SDRs ACTIVOS',magic:MO.sdrs_out[mi],real:gv('sdrs_out',mi),fmt:'int'}];h+='<div class="summary-grid">'+renderSummaryCards(cards)+'</div>';if(curView==='hoy'){h+=sec('o_pace','üìç','Progreso Hoy','purple','<div class="pace-grid">'+(gv('mrr_out',mi)!=null?renderPaceProgressCard('NEW MRR OUTBOUND',gv('mrr_out',mi),MO.new_mrr_out[mi],mi):'')+(gv('sqls_out',mi)!=null?renderPaceProgressCard('SQLs OUTBOUND',gv('sqls_out',mi),MO.sqls_out[mi],mi):'')+'</div>',false);}else if(curView==='proj'){h+=sec('o_proj','üìà','Proyecci√≥n Cierre de Mes','purple','<div class="pace-grid">'+(gv('mrr_out',mi)!=null?renderProjectionCard('NEW MRR OUTBOUND',gv('mrr_out',mi),MO.new_mrr_out[mi],mi):'')+(gv('sqls_out',mi)!=null?renderProjectionCard('SQLs OUTBOUND',gv('sqls_out',mi),MO.sqls_out[mi],mi):'')+'</div>',false);}h+=sec('o_sit','üìã','Lectura de la Situacion','green',renderSit('outbound',mi));h+=sec('o_act_team','üìä','Media Actividades Equipo Outbound (Hist√≥rico vs Este Mes)','orange',renderTeamActivity('sdr_out','SDR Outbound'));h+=sec('o_sdr','üìä','Actividad SDRs Outbound por Persona (HubSpot)','orange',renderPersonCards(SDR_OUT,true),false);let t='<table class="ktable">';t+=renderKpiBlock({id:'mrr_out',name:'New MRR Outbound',magicVal:MO.new_mrr_out[mi],fmt:'eurInt'},mi);t+='</table>';h+=sec('o_mrr','üí∞','MRR','green',t);t='<table class="ktable">';t+=renderKpiBlock({id:'sqls_out',name:'SQLs Outbound',magicVal:MO.sqls_out[mi],fmt:'int'},mi);t+='</table>';h+=sec('o_sql','üìû','SQLs','cyan',t);t='<table class="ktable">';t+=renderKpiBlock({id:'rate_hql_out',name:'% HQL‚ÜíSQL',magicVal:MO.rate_sql_hql[mi],fmt:'pct'},mi);t+='</table>';h+=sec('o_rate','‚ö°','Ratios','purple',t);t='<table class="ktable">';t+=renderKpiBlock({id:'arpa_out',name:'ARPA Outbound',magicVal:MO.arpa_out[mi],fmt:'eur'},mi);t+='</table>';h+=sec('o_arpa','üíé','ARPA','pink',t);document.getElementById('ct_outbound').innerHTML=h;}
function renderAE(mi){let h='<div class="subtab-bar">';h+=`<div class="subtab ${curAESub==='general'?'active':''}" onclick="switchAESub('general')">üìä General AE</div>`;AE_TEAMS.forEach(t=>{h+=`<div class="subtab ${curAESub===t.id?'active':''}" onclick="switchAESub('${t.id}')">${t.houseName||t.name}</div>`;});h+='</div>';
if(curAESub==='general'){
  const getTeamValue=(teamId, fieldName)=>gv('ae_'+teamId+'_'+fieldName, mi);
  const getTeamMemberCount=(teamId)=>{const team=AE_TEAMS.find(t=>t.id===teamId);return team?team.members.length:0;};
  
  const teamIds = ['espartanos', 'abejitas', 'calamares', 'tiburones'];
  
  let totalSqls = null;
  const teamSqlsValues = teamIds.map(tid => getTeamValue(tid, 'sqls'));
  if (teamSqlsValues.some(v => v !== null)) {
    totalSqls = teamSqlsValues.reduce((sum, v) => sum + (v || 0), 0);
  }
  
  let totalMembers = 0;
  let weightedRateIn = 0;
  let weightedRateOut = 0;
  let hasAnyRate = false;
  
  teamIds.forEach(tid => {
    const rateIn = getTeamValue(tid, 'rate_in');
    const rateOut = getTeamValue(tid, 'rate_out');
    const memberCount = getTeamMemberCount(tid);
    totalMembers += memberCount;
    
    if (rateIn !== null) {
      weightedRateIn += rateIn * memberCount;
      hasAnyRate = true;
    }
    if (rateOut !== null) {
      weightedRateOut += rateOut * memberCount;
      hasAnyRate = true;
    }
  });
  
  let aggRateIn = null;
  let aggRateOut = null;
  if (hasAnyRate && totalMembers > 0) {
    aggRateIn = weightedRateIn / totalMembers;
    aggRateOut = weightedRateOut / totalMembers;
  }
  
  let weightedArpa = 0;
  let hasArpa = false;
  teamIds.forEach(tid => {
    const arpa = getTeamValue(tid, 'arpa');
    const memberCount = getTeamMemberCount(tid);
    if (arpa !== null) {
      weightedArpa += arpa * memberCount;
      hasArpa = true;
    }
  });
  
  let aggArpa = null;
  if (hasArpa && totalMembers > 0) {
    aggArpa = weightedArpa / totalMembers;
  }
  
  const teamAccSum=getTeamAccountsSum(mi);
  const aeMag=MA.ae_activos[mi];
  const mrrObjD=getTeamMrrObjSum(mi);const mrrRealTeamSum=getTeamMrrRealSum(mi);
  const aeVentas=getTeamVentasSum(mi);
  const aeRatioComp=(aeVentas!=null&&totalSqls!=null&&totalSqls>0)?aeVentas/totalSqls:null;
  const aeMrrTotal=mrrRealTeamSum;
  const aeArpaComp=(aeVentas!=null&&aeVentas>0&&aeMrrTotal!=null)?aeMrrTotal/aeVentas:null;
  const aeRatioMagic=(MA.rate_in[mi]+MA.rate_out[mi])/2;
  if(totalSqls!=null)sv('ae_sqls',mi,totalSqls);
  if(aeVentas!=null)sv('ae_ventas',mi,aeVentas);
  if(aeArpaComp!=null)sv('ae_arpa',mi,aeArpaComp);
  if(aeRatioComp!=null){sv('ae_rate_in',mi,aeRatioComp);sv('ae_rate_out',mi,aeRatioComp);}
  const cards=[{label:'MRR TOTAL (AE)',magic:MA.direct_mrr[mi],real:mrrRealTeamSum,fmt:'eurInt'},{label:'MRR OBJ (Œ£ EQUIPOS)',magic:MA.direct_mrr[mi],real:mrrObjD.hasAny?mrrObjD.sum:null,fmt:'eurInt'},{label:'AE ACTIVOS',magic:aeMag,real:teamAccSum,fmt:'int'},{label:'Nro SQLs (AE)',magic:MA.sqls[mi],real:totalSqls,fmt:'int'},{label:'VENTAS CERRADAS',magic:Math.round(MA.sqls[mi]*aeRatioMagic),real:aeVentas,fmt:'int'},{label:'ARPA GENERAL',magic:MA.arpa[mi],real:aeArpaComp,fmt:'eur'},{label:'RATIO CONVERSI√ìN',magic:aeRatioMagic,real:aeRatioComp,fmt:'pct'}];
  h+='<div class="summary-grid">'+renderSummaryCards(cards)+'</div>';

  h+=sec('ae_sit','üìã','Lectura de la Situacion ‚Äî AE','green',renderSit('ae',mi));
  
  let t='<table class="ktable"><tr class="r-magic"><td>Nro AEs Activos</td><td>MAGIC BALL</td><td>'+f(aeMag,'int')+'</td></tr><tr class="r-auto"><td></td><td>REAL (SUMA)</td><td class="'+(teamAccSum!=null?teamAccSum-aeMag:null)+'">'+(teamAccSum!=null?f(teamAccSum,'int'):'Managers rellenan en sus tabs')+'</td></tr><tr class="r-var"><td></td><td>Var.</td><td class="'+(teamAccSum!=null?teamAccSum-aeMag:null)+'">'+(teamAccSum!=null?f(teamAccSum-aeMag,'int'):'‚Äî')+'</td></tr></table>';
  h+=sec('ae_act','üë•','AEs Activos (Consolidado)','purple',t);

  const mrrDet=getTeamMrrDetail(mi);
  t='<table class="ktable">';
  t+='<tr class="r-magic"><td>Objetivo Magic Ball</td><td>MAGIC BALL</td><td>'+f(MA.direct_mrr[mi],'eurInt')+'</td></tr>';
  if(mrrObjD.hasAny){
    mrrDet.forEach(md=>{if(md.obj!=null)t+='<tr class="r-auto"><td style="font-size:10px;color:var(--dim)">'+md.name+' (Obj)</td><td>OBJ</td><td>'+f(md.obj,'eurInt')+'</td></tr>';});
    t+='<tr class="r-auto"><td style="color:var(--cyan);font-weight:700">Total Obj Equipos</td><td>Œ£ OBJ</td><td style="font-weight:700;color:var(--cyan)">'+f(mrrObjD.sum,'eurInt')+'</td></tr>';
    const mrrObjDiff=mrrObjD.sum-MA.direct_mrr[mi];
    if(mrrObjD.allFilled&&mrrObjDiff!==0){t+='<tr class="r-var"><td style="color:var(--red);font-weight:700">‚ö†Ô∏è INCIDENCIA</td><td>Diferencia</td><td style="color:var(--red);font-weight:700">'+(mrrObjDiff>0?'+':'')+f(mrrObjDiff,'eurInt')+' ‚Äî objetivo equipos no coincide con Magic Ball</td></tr>';}
    else if(mrrObjD.allFilled&&mrrObjDiff===0){t+='<tr class="r-var"><td style="color:var(--grn);font-weight:700">‚úÖ Coincide</td><td>Diferencia</td><td style="color:var(--grn)">0 ‚Äî objetivos alineados con Magic Ball</td></tr>';}
    t+='<tr class="sep"><td colspan="3"></td></tr>';
  }
  if(mrrRealTeamSum!=null){
    mrrDet.forEach(md=>{if(md.real!=null)t+='<tr class="r-auto"><td style="font-size:10px;color:var(--dim)">'+md.name+' (Real)</td><td>REAL</td><td>'+f(md.real,'eurInt')+'</td></tr>';});
    const mrrRealDiff=mrrRealTeamSum-MA.direct_mrr[mi];const mrrRealPct=MA.direct_mrr[mi]>0?mrrRealDiff/MA.direct_mrr[mi]:0;
    t+='<tr class="r-auto"><td style="color:var(--grn);font-weight:700">Total MRR Real Equipos</td><td>Œ£ REAL</td><td style="font-weight:700;color:'+(mrrRealDiff>=0?'var(--grn)':'var(--red)')+'">'+f(mrrRealTeamSum,'eurInt')+'</td></tr>';
    t+='<tr class="r-var"><td></td><td>Var. vs Magic</td><td style="color:'+(mrrRealDiff>=0?'var(--grn)':'var(--red)')+'">'+(mrrRealDiff>0?'+':'')+f(mrrRealDiff,'eurInt')+' ('+fp(mrrRealPct)+')</td></tr>';
  }else{
    t+='<tr class="r-auto"><td>MRR Real (Œ£ equipos)</td><td>REAL</td><td>Managers rellenan en sus tabs</td></tr>';
  }
  t+='</table>';
  h+=sec('ae_mrr','üí∞','MRR por Equipos','purple',t);

  const projD=getTeamSqlsProjSum(mi);const projDet=getTeamSqlsProjDetail(mi);
  t='<table class="ktable">';
  t+='<tr class="r-magic"><td>Objetivo Magic Ball</td><td>MAGIC BALL</td><td>'+f(MA.sqls[mi],'int')+'</td></tr>';
  if(projD.hasAny){
    projDet.forEach(pd=>{if(pd.proj!=null)t+='<tr class="r-auto"><td style="font-size:10px;color:var(--dim)">'+pd.name+' ('+pd.aes+'√ó'+pd.sqlsPer+')</td><td>PROY</td><td>'+f(pd.proj,'int')+'</td></tr>';});
    t+='<tr class="r-auto"><td style="color:var(--cyan);font-weight:700">Total SQLs Proyectados</td><td>Œ£ PROY</td><td style="font-weight:700;color:var(--cyan)">'+f(projD.sum,'int')+'</td></tr>';
    const pDiff=projD.sum-MA.sqls[mi];
    if(projD.allFilled&&pDiff!==0){t+='<tr class="r-var"><td style="color:var(--red);font-weight:700">‚ö†Ô∏è INCIDENCIA</td><td>Diferencia</td><td style="color:var(--red);font-weight:700">'+(pDiff>0?'+':'')+pDiff+' SQLs ‚Äî total proyectado no coincide con objetivo</td></tr>';}
    else if(projD.allFilled&&pDiff===0){t+='<tr class="r-var"><td style="color:var(--grn);font-weight:700">‚úÖ Coincide</td><td>Diferencia</td><td style="color:var(--grn)">0 ‚Äî proyecci√≥n alineada con Magic Ball</td></tr>';}
    t+='<tr class="sep"><td colspan="3"></td></tr>';
  }
  if (totalSqls !== null) {
    const sqlDelta = totalSqls - MA.sqls[mi];
    const sqlPct = sqlDelta / MA.sqls[mi];
    t+='<tr class="r-auto"><td>SQLs Reales (Œ£ equipos)</td><td>REAL</td><td class="'+(sqlDelta>=0?'ok':'alert')+'">'+f(totalSqls,'int')+'</td></tr>';
    t+='<tr class="r-var"><td></td><td>Var. vs Magic</td><td class="'+(sqlDelta>=0?'ok':'alert')+'">'+f(sqlDelta,'int')+' ('+fp(sqlPct)+')</td></tr>';
  } else {
    t+='<tr class="r-auto"><td>SQLs Reales (Œ£ equipos)</td><td>REAL</td><td>Rellenar datos en equipos</td></tr>';
  }
  t+='</table>';
  h+=sec('ae_sql','üéØ','SQLs','purple',t);
  
  const ventasMagic=Math.round(MA.sqls[mi]*aeRatioMagic);
  const ventasDet=getTeamVentasDetail(mi);
  t='<table class="ktable">';
  t+='<tr class="r-magic"><td>Ventas Cerradas (Won Deals)</td><td>MAGIC BALL</td><td>'+f(ventasMagic,'int')+'</td></tr>';
  if(aeVentas!=null){
    ventasDet.forEach(vd=>{if(vd.ventas!=null)t+='<tr class="r-auto"><td style="font-size:10px;color:var(--dim)">'+vd.name+' (Ventas)</td><td>REAL</td><td>'+f(vd.ventas,'int')+'</td></tr>';});
    const vD=aeVentas-ventasMagic;const vP=ventasMagic>0?vD/ventasMagic:0;
    t+='<tr class="r-auto"><td style="color:var(--gold);font-weight:700">Total Ventas Cerradas</td><td>Œ£ REAL</td><td style="font-weight:700" class="'+dcPct(vP)+'">'+f(aeVentas,'int')+'</td></tr>';
    t+='<tr class="r-var"><td></td><td>Var. vs Magic</td><td class="'+dcPct(vP)+'">'+fd(vD,'int')+' ('+fp(vP)+')</td></tr>';
  }else{
    t+='<tr class="r-auto"><td>Ventas Cerradas (Œ£ equipos)</td><td>REAL</td><td>Managers rellenan en sus tabs</td></tr>';
  }
  t+='<tr class="sep"><td colspan="3"></td></tr>';
  t+='<tr class="r-magic"><td>Ratio Conversi√≥n General (Ventas/SQLs)</td><td>MAGIC BALL</td><td>'+fp(aeRatioMagic)+'</td></tr>';
  if(aeRatioComp!=null){const rD=aeRatioComp-aeRatioMagic;const rP=aeRatioMagic>0?rD/aeRatioMagic:0;t+='<tr class="r-auto"><td></td><td>REAL (AUTO)</td><td class="'+dcPct(rP)+'">'+fp(aeRatioComp)+'</td></tr>';t+='<tr class="r-var"><td></td><td>Var.</td><td class="'+dcPct(rP)+'">'+fp(rD)+' ('+fp(rP)+')</td></tr>';}
  else{t+='<tr class="r-auto"><td></td><td>REAL (AUTO)</td><td>Managers rellenan Ventas en sus tabs</td></tr>';}
  t+='<tr class="sep"><td colspan="3"></td></tr>';
  t+='<tr class="r-magic"><td>ARPA General (MRR/Ventas)</td><td>MAGIC BALL</td><td>'+f(MA.arpa[mi],'eur')+'</td></tr>';
  if(aeArpaComp!=null){const aD=aeArpaComp-MA.arpa[mi];const aP=MA.arpa[mi]>0?aD/MA.arpa[mi]:0;t+='<tr class="r-auto"><td></td><td>REAL (AUTO)</td><td class="'+dcPct(aP)+'">'+f(aeArpaComp,'eur')+'</td></tr>';t+='<tr class="r-var"><td></td><td>Var.</td><td class="'+dcPct(aP)+'">'+f(aD,'eur')+' ('+fp(aP)+')</td></tr>';}
  else{t+='<tr class="r-auto"><td></td><td>REAL (AUTO)</td><td>Managers rellenan Ventas y MRR en sus tabs</td></tr>';}
  t+='</table>';
  h+=sec('ae_ventas_sec','üèÜ','Ventas ¬∑ Ratio ¬∑ ARPA (Œ£ Equipos)','purple',t);
  
  h+=sec('ae_act_team','üìä','Media Actividades AE Total (Hist√≥rico vs Este Mes)','purple',renderTeamActivity('ae_total','AE Total'));
  let tc='';AE_TEAMS.forEach(team=>{const active=filterActive(team.members);const avgA=active.length?(active.reduce((s,m)=>s+m.avg_act,0)/active.length).toFixed(1):'‚Äî';const tAes=gv('ae_'+team.id+'_aes_activos',mi);const tSqlP=gv('ae_'+team.id+'_sqls_persona',mi);const tProy=(tAes!=null&&tSqlP!=null)?Math.round(tAes*tSqlP):null;const tMrrObj=gv('ae_'+team.id+'_mrr_obj',mi);const tMrrReal=gv('ae_'+team.id+'_mrr_real',mi);const tVentas=gv('ae_'+team.id+'_ventas',mi);tc+=`<div style="margin-bottom:14px"><div style="display:flex;align-items:center;gap:12px;padding:8px 0"><img src="${CRESTS[team.id]}" style="width:50px;height:auto;filter:drop-shadow(0 0 10px rgba(178,75,243,.3))"/><div><div style="font-family:'Orbitron',monospace;font-size:11px;font-weight:700;color:${team.color};letter-spacing:1px">${team.houseName||team.name.toUpperCase()}</div><div style="font-size:10px;color:var(--dim)">AEs: ${tAes!=null?tAes:'‚Äî'} ¬∑ SQLs/pers: ${tSqlP!=null?tSqlP:'‚Äî'} ¬∑ Proy: ${tProy!=null?tProy:'‚Äî'} ¬∑ Media: ${avgA} act/SQL</div><div style="font-size:10px;color:var(--dim)">MRR Obj: ${tMrrObj!=null?f(tMrrObj,'eurInt'):'‚Äî'} ¬∑ MRR Real: <span style="color:${tMrrReal!=null&&tMrrObj!=null?(tMrrReal>=tMrrObj?'var(--grn)':'var(--red)'):'var(--dim)'}">${tMrrReal!=null?f(tMrrReal,'eurInt'):'‚Äî'}</span> ¬∑ Ventas: <span style="color:var(--gold)">${tVentas!=null?tVentas:'‚Äî'}</span></div></div></div>`;tc+=renderPersonCards(team.members,false);tc+='</div>';});h+=sec('ae_teams','üè∞','Equipos AE','purple',tc,false);
  
  const dec=decompAE(mi);h+=sec('ae_dev','üî¨','Diagnostico Desviacion AE','purple',renderDeviation(dec.effects,dec.totDev,MA.sqls[mi]*MA.arpa[mi]*((MA.rate_in[mi]+MA.rate_out[mi])/2),dec.hasData));
}
else{const team=AE_TEAMS.find(t=>t.id===curAESub);if(!team)return;const prefix='ae_'+team.id+'_';const active=filterActive(team.members);const avgA=active.length?(active.reduce((s,m)=>s+m.avg_act,0)/active.length).toFixed(1):'‚Äî';const totS=active.reduce((s,m)=>s+m.sqls,0);const bAes=gv(prefix+'aes_activos',mi);const bSqlP=gv(prefix+'sqls_persona',mi);const bProy=(bAes!=null&&bSqlP!=null)?Math.round(bAes*bSqlP):null;const bMrrObj=gv(prefix+'mrr_obj',mi);const bMrrReal=gv(prefix+'mrr_real',mi);const bVentas=gv(prefix+'ventas',mi);const bSqlsR=gv(prefix+'sqls',mi);const bArpaAuto=(bVentas!=null&&bVentas>0&&bMrrReal!=null)?bMrrReal/bVentas:null;const bRatioAuto=(bVentas!=null&&bSqlsR!=null&&bSqlsR>0)?bVentas/bSqlsR:null;
h+=`<div class="team-banner"><div class="crest"><img src="${CRESTS[team.id]}" alt="${team.name}"/></div><div class="team-info"><div class="team-name" style="color:${team.color}">${team.houseName||team.name.toUpperCase()}</div><div class="team-stats">AEs: <span>${bAes!=null?bAes:'‚Äî'}</span> ¬∑ SQLs/pers: <span>${bSqlP!=null?bSqlP:'‚Äî'}</span> ¬∑ Proy: <span>${bProy!=null?bProy:'‚Äî'}</span> ¬∑ Media: <span>${avgA}</span> act/SQL</div><div class="team-stats" style="margin-top:2px">MRR Obj: <span style="color:var(--cyan)">${bMrrObj!=null?f(bMrrObj,'eurInt'):'‚Äî'}</span> ¬∑ MRR Real: <span style="color:${bMrrReal!=null&&bMrrObj!=null?(bMrrReal>=bMrrObj?'var(--grn)':'var(--red)'):'var(--dim)'}">${bMrrReal!=null?f(bMrrReal,'eurInt'):'‚Äî'}</span> ¬∑ Ventas: <span style="color:var(--cyan)">${bVentas!=null?bVentas:'‚Äî'}</span></div></div></div>`;
let t='<table class="ktable">';t+='<tr class="r-real"><td style="color:var(--cyan);font-weight:700">AEs Activos '+team.name+'</td><td>INPUT</td><td><input value="'+(bAes!=null?bAes:'')+'" placeholder="ej: 4.5" onchange="hi(\''+prefix+'aes_activos\','+mi+',this.value,\'dec\')" onfocus="this.select()" style="width:80px"/></td></tr>';t+='<tr class="r-real"><td style="color:var(--cyan);font-weight:700">SQLs / Persona</td><td>INPUT</td><td><input value="'+(bSqlP!=null?bSqlP:'')+'" placeholder="sqls/persona" onchange="hi(\''+prefix+'sqls_persona\','+mi+',this.value,\'int\')" onfocus="this.select()" style="width:80px"/></td></tr>';t+='<tr class="r-auto"><td style="color:var(--pink);font-weight:700">SQLs Proyectados</td><td>AUTO</td><td style="font-weight:700;color:var(--cyan)">'+(bProy!=null?f(bProy,'int'):'Rellenar AEs y SQLs/persona')+'</td></tr>';t+='<tr class="sep"><td colspan="3"></td></tr>';t+='<tr class="r-real"><td style="color:var(--grn);font-weight:700">üí∞ Objetivo MRR '+team.name+'</td><td>INPUT</td><td><input value="'+(bMrrObj!=null?bMrrObj:'')+'" placeholder="ej: 8000" onchange="hi(\''+prefix+'mrr_obj\','+mi+',this.value,\'int\')" onfocus="this.select()" style="width:100px"/></td></tr>';t+='<tr class="r-real"><td style="color:var(--grn);font-weight:700">üí∞ MRR Real '+team.name+'</td><td>INPUT</td><td><input value="'+(bMrrReal!=null?bMrrReal:'')+'" placeholder="MRR conseguido" onchange="hi(\''+prefix+'mrr_real\','+mi+',this.value,\'int\')" onfocus="this.select()" style="width:100px"/></td></tr>';if(bMrrObj!=null&&bMrrReal!=null){const mrrDiff=bMrrReal-bMrrObj;const mrrPct=bMrrObj>0?mrrDiff/bMrrObj:0;t+='<tr class="r-var"><td style="color:'+(mrrDiff>=0?'var(--grn)':'var(--red)')+';font-weight:700">Var. MRR</td><td>AUTO</td><td style="color:'+(mrrDiff>=0?'var(--grn)':'var(--red)')+';font-weight:700">'+(mrrDiff>0?'+':'')+f(mrrDiff,'eurInt')+' ('+fp(mrrPct)+')</td></tr>';}
t+='<tr class="sep"><td colspan="3"></td></tr>';
t+='<tr class="r-real"><td style="color:var(--gold);font-weight:700">üèÜ Ventas Cerradas '+team.name+'</td><td>INPUT</td><td><input value="'+(bVentas!=null?bVentas:'')+'" placeholder="n¬∫ ventas won" onchange="hi(\''+prefix+'ventas\','+mi+',this.value,\'int\')" onfocus="this.select()" style="width:80px"/></td></tr>';
if(bArpaAuto!=null){const apD=bArpaAuto-MA.arpa[mi];const apP=MA.arpa[mi]>0?apD/MA.arpa[mi]:0;t+='<tr class="r-auto"><td style="color:var(--gold)">ARPA '+team.name+' (MRR/Ventas)</td><td>AUTO</td><td class="'+dcPct(apP)+'">'+f(bArpaAuto,'eur')+'</td></tr>';}
if(bRatioAuto!=null){const rtM=(MA.rate_in[mi]+MA.rate_out[mi])/2;const rtD=bRatioAuto-rtM;const rtP=rtM>0?rtD/rtM:0;t+='<tr class="r-auto"><td style="color:var(--gold)">Ratio Conversi√≥n (Ventas/SQLs)</td><td>AUTO</td><td class="'+dcPct(rtP)+'">'+fp(bRatioAuto)+'</td></tr>';}
t+='</table>';h+=sec(team.id+'_cfg','üìã','Configuraci√≥n Mensual','purple',t);h+=sec(team.id+'_act_team','üìä','Media Actividades '+team.name+' (Hist√≥rico vs Este Mes)','purple',renderTeamActivity(team.id,team.name));h+=sec(team.id+'_cards','üë•','Miembros','purple',renderPersonCards(team.members,false));t='<table class="ktable">';t+=renderKpiBlock({id:prefix+'sqls',name:'SQLs Reales '+team.name,magicVal:bProy!=null?bProy:Math.round(MA.sqls[mi]*team.members.length/17),fmt:'int'},mi);t+='</table>';h+=sec(team.id+'_sql','üéØ','SQLs','purple',t);}
document.getElementById('ct_ae').innerHTML=h;}
function renderGeneral(mi){let h='';const mrrInM=MI.direct_mrr[mi],mrrOutM=MO.new_mrr_out[mi];const mrrTM=MA.direct_mrr[mi];const mrrInR=gv('direct_mrr',mi),mrrOutR=gv('mrr_out',mi);const mrrTR=(mrrInR!=null&&mrrOutR!=null)?mrrInR+mrrOutR:null;
const hSqlInR=gv('sqls_paid',mi),hSqlInI=gv('sqls_inbound',mi),hSqlOutR=gv('sqls_out',mi);
const hSqlTotalR=(hSqlInR!=null&&hSqlInI!=null&&hSqlOutR!=null)?hSqlInR+hSqlInI+hSqlOutR:((hSqlInR!=null||hSqlInI!=null||hSqlOutR!=null)?(hSqlInR||0)+(hSqlInI||0)+(hSqlOutR||0):null);
const hSqlTotalM=MI.sqls_paid[mi]+MI.sqls_inbound[mi]+MO.sqls_out[mi];
const hArpaM=MA.arpa[mi];
const hAeVentas=getTeamVentasSum(mi);const hAeMrr=getTeamMrrRealSum(mi);
const hArpaR=(hAeVentas!=null&&hAeVentas>0&&hAeMrr!=null)?hAeMrr/hAeVentas:null;
const hAeSqls=getTeamSqlsRealSum(mi)||gv('ae_sqls',mi);
const hRatioR=(hAeVentas!=null&&hAeSqls!=null&&hAeSqls>0)?hAeVentas/hAeSqls:null;
const hRatioM=(MA.rate_in[mi]+MA.rate_out[mi])/2;
function heroCard(label,real,magic,fmt,icon,extraCls){const d=real!=null?real-magic:null;const p=(d!=null&&magic)?d/magic:null;const cls=d==null?'neutral':(p>=0?'ok':(p>-0.10?'neutral':'alert'));const dCls=dcPct(p).replace('delta-','');let dTxt='Sin datos';if(p!=null){if(fmt==='pct'){dTxt=(d>=0?'+':'')+fp(d)+' ('+fp(p)+')';}else{dTxt=(d>=0?'+':'')+f(d,fmt)+' ('+fp(p)+')';}}
return'<div class="hero-card '+cls+' '+extraCls+'"><div class="hero-icon">'+icon+'</div><div class="hero-label">'+label+'</div><div class="hero-value">'+(real!=null?f(real,fmt):'‚Äî')+'</div><div class="hero-obj">Objetivo Magic Ball: <span>'+f(magic,fmt)+'</span></div><div class="hero-delta '+dcPct(p)+'">'+dTxt+'</div></div>';}
h+='<div class="hero-metrics">';
h+=heroCard('üí∞ MRR TOTAL ‚Äî EL RESULTADO',mrrTR,mrrTM,'eurInt','üèÜ','hero-mrr');
h+='<div class="hero-row">';
h+=heroCard('üéØ OPORTUNIDADES (SQLs IN+OUT)',hSqlTotalR,hSqlTotalM,'int','‚ö°','hero-secondary');
h+=heroCard('üíé ARPA GENERAL',hArpaR,hArpaM,'eur','üíé','hero-secondary');
h+=heroCard('üîÑ RATIO CONVERSI√ìN GENERAL',hRatioR,hRatioM,'pct','üîÑ','hero-secondary');
h+='</div>';
const aeSqlR=getTeamSqlsRealSum(mi)||gv('ae_sqls',mi);if(hSqlTotalR!=null&&aeSqlR!=null){const sqlDisc=Math.abs(hSqlTotalR-aeSqlR);const sqlDiscPct=hSqlTotalR>0?sqlDisc/hSqlTotalR:0;if(sqlDiscPct>0.001&&sqlDiscPct<=0.03){h+='<div style="background:rgba(253,203,110,.15);border:1px solid var(--yel);border-radius:8px;padding:8px 14px;margin-top:8px;font-size:10px;color:var(--dim)">‚ÑπÔ∏è Discrepancia SQLs In+Out (<b>'+hSqlTotalR+'</b>) vs reporte AE (<b>'+aeSqlR+'</b>): <b>'+Math.round(sqlDiscPct*100)+'%</b> ‚Äî dentro del margen aceptable (canal Partners).</div>';}else if(sqlDiscPct>0.03){h+='<div style="background:rgba(255,82,82,.12);border:1px solid var(--red);border-radius:8px;padding:8px 14px;margin-top:8px;font-size:10px;color:var(--dim)">‚ö†Ô∏è Discrepancia SQLs In+Out (<b>'+hSqlTotalR+'</b>) vs reporte AE (<b>'+aeSqlR+'</b>): <b>'+Math.round(sqlDiscPct*100)+'%</b> ‚Äî supera el 3% habitual. Revisar datos.</div>';}}
h+='</div>';
const cards=[{label:'MRR INBOUND',magic:mrrInM,real:mrrInR,fmt:'eurInt'},{label:'MRR OUTBOUND',magic:mrrOutM,real:mrrOutR,fmt:'eurInt'},{label:'SQLs TOTAL (AE)',magic:MA.sqls[mi],real:getTeamSqlsRealSum(mi)||gv('ae_sqls',mi),fmt:'int'},{label:'VENTAS CERRADAS',magic:Math.round(MA.sqls[mi]*hRatioM),real:hAeVentas,fmt:'int'},{label:'AE ACTIVOS',magic:MA.ae_activos[mi],real:getTeamAccountsSum(mi),fmt:'int'}];h+='<div class="summary-grid">'+renderSummaryCards(cards)+'</div>';
h+=sec('g_sem','üö¶','Sem√°foro por Equipo (Proyecci√≥n SQLs)','purple',renderSemaforo(mi));
const gProjD=getTeamSqlsProjSum(mi);if(gProjD.hasAny&&gProjD.allFilled){const gPDiff=gProjD.sum-MA.sqls[mi];if(gPDiff!==0){h+='<div style="background:rgba(255,82,82,.15);border:1px solid var(--red);border-radius:8px;padding:12px 16px;margin:8px 0;font-size:11px;line-height:1.6"><span style="color:var(--red);font-weight:700">‚ö†Ô∏è INCIDENCIA SQLs:</span> El total de SQLs proyectados por los equipos AE (<b>'+gProjD.sum+'</b>) no coincide con el objetivo del Magic Ball (<b>'+MA.sqls[mi]+'</b>). Diferencia: <b>'+(gPDiff>0?'+':'')+gPDiff+'</b> SQLs. Revisar distribuci√≥n AEs activos √ó SQLs/persona en cada equipo.</div>';}else{h+='<div style="background:rgba(0,230,118,.1);border:1px solid var(--grn);border-radius:8px;padding:12px 16px;margin:8px 0;font-size:11px;line-height:1.6"><span style="color:var(--grn);font-weight:700">‚úÖ SQLs ALINEADOS:</span> Total proyectado (<b>'+gProjD.sum+'</b>) coincide con objetivo Magic Ball (<b>'+MA.sqls[mi]+'</b>).</div>';}}
const gMrrObj=getTeamMrrObjSum(mi);const gMrrReal=getTeamMrrRealSum(mi);const gMrrDet=getTeamMrrDetail(mi);
if(gMrrObj.hasAny&&gMrrObj.allFilled){const gMDiff=gMrrObj.sum-MA.direct_mrr[mi];if(gMDiff!==0){h+='<div style="background:rgba(255,82,82,.15);border:1px solid var(--red);border-radius:8px;padding:12px 16px;margin:8px 0;font-size:11px;line-height:1.6"><span style="color:var(--red);font-weight:700">‚ö†Ô∏è INCIDENCIA MRR:</span> La suma de objetivos MRR por equipo (<b>'+f(gMrrObj.sum,'eurInt')+'</b>) no coincide con el Magic Ball (<b>'+f(MA.direct_mrr[mi],'eurInt')+'</b>). Diferencia: <b>'+(gMDiff>0?'+':'')+f(gMDiff,'eurInt')+'</b>. Revisar objetivo de cada equipo.</div>';}else{h+='<div style="background:rgba(0,230,118,.1);border:1px solid var(--grn);border-radius:8px;padding:12px 16px;margin:8px 0;font-size:11px;line-height:1.6"><span style="color:var(--grn);font-weight:700">‚úÖ MRR ALINEADO:</span> Suma objetivos equipos (<b>'+f(gMrrObj.sum,'eurInt')+'</b>) coincide con Magic Ball.</div>';}}
if(gMrrObj.hasAny||gMrrReal!=null){let mrrH='<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:12px">';const consec=gMrrObj.hasAny&&gMrrReal!=null&&gMrrObj.sum>0?gMrrReal/gMrrObj.sum:null;mrrH+='<div style="background:var(--bg2);border:1px solid var(--brd);border-radius:10px;padding:16px;text-align:center"><div style="font-size:9px;color:var(--dim);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">% Consecuci√≥n MRR</div><div style="font-size:28px;font-weight:900;font-family:Orbitron,monospace;color:'+(consec!=null?(consec>=1?'var(--grn)':consec>=0.8?'var(--org)':'var(--red)'):'var(--dim)')+'">'+(consec!=null?Math.round(consec*100)+'%':'‚Äî')+'</div><div style="font-size:9px;color:var(--dim);margin-top:4px">'+(gMrrReal!=null?f(gMrrReal,'eurInt'):' ‚Äî ')+' / '+(gMrrObj.hasAny?f(gMrrObj.sum,'eurInt'):'‚Äî')+'</div></div>';gMrrDet.forEach(md=>{const tc=md.obj!=null&&md.real!=null&&md.obj>0?md.real/md.obj:null;mrrH+='<div style="background:var(--bg2);border:1px solid var(--brd);border-radius:10px;padding:12px;text-align:center"><div style="font-size:9px;color:var(--dim);letter-spacing:1px;margin-bottom:4px">'+md.name+'</div><div style="font-size:20px;font-weight:700;font-family:Orbitron,monospace;color:'+(tc!=null?(tc>=1?'var(--grn)':tc>=0.8?'var(--org)':'var(--red)'):'var(--dim)')+'">'+(tc!=null?Math.round(tc*100)+'%':'‚Äî')+'</div><div style="font-size:9px;color:var(--dim);margin-top:3px">'+(md.real!=null?f(md.real,'eurInt'):'‚Äî')+' / '+(md.obj!=null?f(md.obj,'eurInt'):'‚Äî')+'</div></div>';});mrrH+='</div>';h+=sec('g_mrr_teams','üí∞','MRR por Equipos ‚Äî % Consecuci√≥n','green',mrrH);}
const gSqlsTotal=getTeamSqlsRealSum(mi)||gv('ae_sqls',mi);
if(curView==='hoy'){h+=sec('g_pace','üìç','Progreso Hoy','purple','<div class="pace-grid">'+(gv('direct_mrr',mi)!=null?renderPaceProgressCard('MRR INBOUND',gv('direct_mrr',mi),mrrInM,mi):'')+(gv('mrr_out',mi)!=null?renderPaceProgressCard('MRR OUTBOUND',gv('mrr_out',mi),mrrOutM,mi):'')+(mrrTR!=null?renderPaceProgressCard('MRR TOTAL',mrrTR,mrrTM,mi):'')+(gSqlsTotal!=null?renderPaceProgressCard('SQLs TOTAL',gSqlsTotal,MA.sqls[mi],mi):'')+'</div>',false);}else if(curView==='proj'){h+=sec('g_proj','üìà','Proyecci√≥n Cierre de Mes','purple','<div class="pace-grid">'+(gv('direct_mrr',mi)!=null?renderProjectionCard('MRR INBOUND',gv('direct_mrr',mi),mrrInM,mi):'')+(gv('mrr_out',mi)!=null?renderProjectionCard('MRR OUTBOUND',gv('mrr_out',mi),mrrOutM,mi):'')+(mrrTR!=null?renderProjectionCard('MRR TOTAL',mrrTR,mrrTM,mi):'')+(gSqlsTotal!=null?renderProjectionCard('SQLs TOTAL',gSqlsTotal,MA.sqls[mi],mi):'')+'</div>',false);}

let gSit='<div class="sit-grid">';const sIA=filterActiveObj(SDR_IN),sOA=filterActiveObj(SDR_OUT),aeA=filterActive(AE_TEAMS.flatMap(t=>t.members));const cnt=Object.keys(sIA).length+Object.keys(sOA).length+aeA.length;const sm=Object.values(sIA).reduce((s,v)=>s+v.avg_act,0)+Object.values(sOA).reduce((s,v)=>s+v.avg_act,0)+aeA.reduce((s,m)=>s+m.avg_act,0);const gA=cnt?sm/cnt:null;const gHistActs=[];if(TEAM_ACT.sdr_in)gHistActs.push(TEAM_ACT.sdr_in);if(TEAM_ACT.sdr_out)gHistActs.push(TEAM_ACT.sdr_out);if(TEAM_ACT.ae_total)gHistActs.push(TEAM_ACT.ae_total);const gHistAvg=gHistActs.length?(gHistActs.reduce((s,t)=>s+t.hist,0)/gHistActs.length):null;const gCurrAvg=gHistActs.length?(gHistActs.reduce((s,t)=>s+t.month,0)/gHistActs.length):null;const gWorkD=(gCurrAvg!=null&&gHistAvg!=null)?gCurrAvg-gHistAvg:null;const gWorkPct=(gWorkD!=null&&gHistAvg>0)?gWorkD/gHistAvg:null;gSit+=sitCard('¬øTRABAJANDO lo suficiente?',gCurrAvg,gWorkD,gWorkPct,'dec');
const sIP=gv('sqls_paid',mi),sII=gv('sqls_inbound',mi),sOR=gv('sqls_out',mi);const sInR=(sIP!=null&&sII!=null)?sIP+sII:null;const sTR=(sInR!=null&&sOR!=null)?sInR+sOR:null;const sTM=MI.sqls_paid[mi]+MI.sqls_inbound[mi]+MO.sqls_out[mi];const sTD=sTR!=null?sTR-sTM:null;const sTDPct=sTD!=null?sTD/sTM:null;gSit+=sitCard('¬øRecibimos suficientes OPORTUNIDADES?',sTR,sTD,sTDPct,'int');
const gVentas=getTeamVentasSum(mi);const gMrrAE=getTeamMrrRealSum(mi);const gArpa=(gVentas!=null&&gVentas>0&&gMrrAE!=null)?gMrrAE/gVentas:null;const gArpaD=gArpa!=null?gArpa-MA.arpa[mi]:null;const gArpaPct=gArpaD!=null?gArpaD/MA.arpa[mi]:null;gSit+=sitCard('¬øVendemos al PRECIO suficiente?',gArpa,gArpaD,gArpaPct,'eur');
const gSqlsAe=getTeamSqlsRealSum(mi)||gv('ae_sqls',mi);const gRatio=(gVentas!=null&&gSqlsAe!=null&&gSqlsAe>0)?gVentas/gSqlsAe:null;const gRatioM=(MA.rate_in[mi]+MA.rate_out[mi])/2;const gRatioD=gRatio!=null?gRatio-gRatioM:null;const gRatioPct=gRatioD!=null?gRatioD/gRatioM:null;gSit+=sitCard('¬øCERRAMOS suficientes deals?',gRatio,gRatioD,gRatioPct,'pct');
gSit+='</div>';const gi=[];if(sTR!=null)gi.push({q:'SQLs',ok:sTD>=0,val:sTR,diff:sTD,pct:sTDPct,fmt:'int'});if(gArpa!=null)gi.push({q:'ARPA',ok:gArpaD>=0,val:gArpa,diff:gArpaD,pct:gArpaPct,fmt:'eur'});if(gRatio!=null)gi.push({q:'Rate',ok:gRatioD>=0,val:gRatio,diff:gRatioD,pct:gRatioPct,fmt:'pct'});if(mrrTR!=null){const mTD=mrrTR-mrrTM;gi.push({q:'MRR',ok:mTD>=0,val:mrrTR,diff:mTD,pct:mTD/mrrTM,fmt:'eurInt'});}gSit+=sitNarr('GLOBAL',null,gi);
h+=sec('g_sit','üìã','Lectura General','green',gSit);const dI=decompInbound(mi);h+=sec('g_in','üê±','Inbound','blue',renderDeviation(dI.effects,dI.totDev,mrrInM,dI.hasData),false);const dO=decompOutbound(mi);h+=sec('g_out','‚ò†Ô∏è','Outbound','orange',renderDeviation(dO.effects,dO.totDev,mrrOutM,dO.hasData),false);const dA=decompAE(mi);h+=sec('g_ae','üèÜ','AE','purple',renderDeviation(dA.effects,dA.totDev,MA.sqls[mi]*MA.arpa[mi]*((MA.rate_in[mi]+MA.rate_out[mi])/2),dA.hasData),false);
let evoH='<div style="margin-bottom:10px"><button onclick="takeManualSnapshot()" style="background:var(--bg3);color:var(--cyan);border:1px solid var(--brd);padding:6px 14px;border-radius:6px;cursor:pointer;font-size:11px;font-family:inherit">üì∏ Hacer foto manual ahora</button> <span style="font-size:9px;color:var(--dim)">Las fotos autom√°ticas se toman cada viernes a las 23:00</span></div>';
evoH+=renderEvolutivo(mi);
h+=sec('g_evo','üì∏','Evolutivo Semanal','cyan',evoH,false);
document.getElementById('ct_general').innerHTML=h;}
function hi(id,mi,raw,fmt){let v=raw.trim();if(v==='-'||v==='‚Äî'){sv(id,mi,0);return;}if(fmt==='dec'){v=v.replace(/[‚Ç¨%\s]/g,'').replace(',','.');}else{v=v.replace(/[‚Ç¨%\s.]/g,'').replace(',','.');}if(v===''){sv(id,mi,null);return;}let n=parseFloat(v);if(isNaN(n))return;if(fmt==='pct')n=n/100;sv(id,mi,n);}
function tog(id){const b=document.getElementById('sb_'+id),t=document.getElementById('tog_'+id),hd=b.closest('.section').querySelector('.sec-head');if(b.classList.contains('open')){b.classList.remove('open');t.classList.remove('open');t.textContent='‚ñ∏';hd.classList.remove('expanded');}else{b.classList.add('open');t.classList.add('open');t.textContent='‚ñæ';hd.classList.add('expanded');}}
function exportCSV(){const mi=curMonth;let csv='Tab,KPI,Magic,Real\n';['mqls_paid','mqls_inbound','sqls_paid','sqls_inbound','arpa_paid','arpa_inbound','sdrs_in','direct_mrr'].forEach(id=>{csv+=`Inbound,${id},${MI[id]?MI[id][mi]:''},${gv(id,mi)||''}\n`;});['sqls_out','rate_hql_out','arpa_out','sdrs_out','mrr_out'].forEach(id=>{csv+=`Outbound,${id},,${gv(id,mi)||''}\n`;});['ae_sqls','ae_ventas','ae_rate_in','ae_rate_out','ae_arpa'].forEach(id=>{csv+=`AE,${id},,${gv(id,mi)||''}\n`;});AE_TEAMS.forEach(t=>{csv+=`AE_${t.name},aes_activos,,${gv('ae_'+t.id+'_aes_activos',mi)||''}\n`;csv+=`AE_${t.name},sqls_persona,,${gv('ae_'+t.id+'_sqls_persona',mi)||''}\n`;csv+=`AE_${t.name},mrr_obj,,${gv('ae_'+t.id+'_mrr_obj',mi)||''}\n`;csv+=`AE_${t.name},mrr_real,,${gv('ae_'+t.id+'_mrr_real',mi)||''}\n`;csv+=`AE_${t.name},ventas,,${gv('ae_'+t.id+'_ventas',mi)||''}\n`;});const blob=new Blob([csv],{type:'text/csv'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=`Panel_${MONTHS[mi].replace(' ','_')}.csv`;a.click();}
function rptLine(label,real,magic,fmt){if(real==null)return label+': Sin datos\n';const d=real-magic,p=magic?d/magic:0;return label+': '+f(real,fmt)+' (obj: '+f(magic,fmt)+') '+(d>=0?'‚ñ≤':'‚ñº')+' '+(d>0?'+':'')+f(d,fmt)+' ('+fp(p)+')\n';}
function rptSitLine(q,val,diff,pct,fmt){if(val==null)return'  '+q+': Sin datos\n';const icon=diff==null?'‚óã':(diff>=0?'‚úÖ':'‚ùå');return'  '+icon+' '+q+': '+f(val,fmt)+(diff!=null?' ('+(diff>0?'+':'')+f(diff,fmt)+', '+fp(pct)+')':'')+'\n';}
function sendReport(){
  const mi=curMonth;let b='';
  b+='‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
  b+='  REPORTE SEMANAL ‚Äî '+MONTHS[mi]+'\n';
  b+='  Por: '+(curUser||'‚Äî')+' ¬∑ '+new Date().toLocaleDateString('es-ES')+'\n';
  b+='‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
  b+='üê± INBOUND\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
  b+=rptLine('MRR Inbound',gv('direct_mrr',mi),MI.direct_mrr[mi],'eurInt');
  b+=rptLine('MQLs Paid',gv('mqls_paid',mi),MI.mqls_paid[mi],'int');
  b+=rptLine('MQLs Inbound',gv('mqls_inbound',mi),MI.mqls_inbound[mi],'int');
  b+=rptLine('SQLs Paid',gv('sqls_paid',mi),MI.sqls_paid[mi],'int');
  b+=rptLine('SQLs Inbound',gv('sqls_inbound',mi),MI.sqls_inbound[mi],'int');
  b+=rptLine('SDRs Activos',gv('sdrs_in',mi),MI.sdrs_in[mi],'int');
  if(SDR_PRESSURE&&SDR_PRESSURE.sdr_in){const pr=SDR_PRESSURE.sdr_in;const sdrs=gv('sdrs_in',mi)||MI.sdrs_in[mi];const de=calDaysElapsed(mi),dm=calDaysInMonth(mi);const proj=dm>0&&de>0?Math.round(pr.curr_deals*(dm/de)):pr.curr_deals;const mqls=sdrs>0?Math.round(proj/sdrs):0;const pp=pr.hist_avg>0?((mqls/pr.hist_avg)-1):0;b+='Presi√≥n MQLs/SDR: '+mqls+' proy vs '+Math.round(pr.hist_avg)+' hist ('+(pp>=0?'+':'')+Math.round(pp*100)+'%)'+(pp>0.1?' ‚Üí PRESIONADOS':pp<-0.1?' ‚Üí Controlado':' ‚Üí Normal')+'\n';}
  const actI=TEAM_ACT.sdr_in;if(actI){const p=actI.hist>0?((actI.month/actI.hist)-1):0;b+='Actividad: '+actI.month+' vs '+actI.hist+' act/lead hist ('+(p>=0?'+':'')+Math.round(p*100)+'%)'+(p<-0.1?' ‚ö†Ô∏è BAJA':p>0.1?' ‚úÖ ALTA':' ‚Üí Normal')+'\n';}
  b+='\n‚ò†Ô∏è OUTBOUND\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
  b+=rptLine('MRR Outbound',gv('mrr_out',mi),MO.new_mrr_out[mi],'eurInt');
  b+=rptLine('SQLs Outbound',gv('sqls_out',mi),MO.sqls_out[mi],'int');
  b+=rptLine('ARPA Outbound',gv('arpa_out',mi),MO.arpa_out[mi],'eur');
  b+=rptLine('% HQL-SQL',gv('rate_hql_out',mi),MO.rate_sql_hql[mi],'pct');
  const actO=TEAM_ACT.sdr_out;if(actO){const p=actO.hist>0?((actO.month/actO.hist)-1):0;b+='Actividad: '+actO.month+' vs '+actO.hist+' act/lead hist ('+(p>=0?'+':'')+Math.round(p*100)+'%)\n';}
  b+='\nüèÜ AE ‚Äî EQUIPOS\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
  b+=rptLine('SQLs Total',gv('ae_sqls',mi),MA.sqls[mi],'int');
  b+=rptLine('ARPA Global',gv('ae_arpa',mi),MA.arpa[mi],'eur');
  b+=rptLine('Rate In',gv('ae_rate_in',mi),MA.rate_in[mi],'pct');
  b+=rptLine('Rate Out',gv('ae_rate_out',mi),MA.rate_out[mi],'pct');
  const projD2=getTeamSqlsProjSum(mi);
  if(projD2.hasAny&&projD2.allFilled){const diff=projD2.sum-MA.sqls[mi];b+=(diff!==0?'‚ö†Ô∏è INCIDENCIA: SQLs proy ('+projD2.sum+') ‚â† Magic Ball ('+MA.sqls[mi]+'), dif: '+(diff>0?'+':'')+diff:'‚úÖ SQLs proy ('+projD2.sum+') = Magic Ball')+'\n';}
  const rptMrrObj=getTeamMrrObjSum(mi);const rptMrrReal=getTeamMrrRealSum(mi);
  if(rptMrrObj.hasAny&&rptMrrObj.allFilled){const mDiff=rptMrrObj.sum-MA.direct_mrr[mi];b+=(mDiff!==0?'‚ö†Ô∏è INCIDENCIA MRR: Œ£ obj equipos ('+f(rptMrrObj.sum,'eurInt')+') ‚â† Magic Ball ('+f(MA.direct_mrr[mi],'eurInt')+'), dif: '+(mDiff>0?'+':'')+f(mDiff,'eurInt'):'‚úÖ MRR obj equipos ('+f(rptMrrObj.sum,'eurInt')+') = Magic Ball')+'\n';}
  if(rptMrrObj.hasAny&&rptMrrReal!=null){const consec=rptMrrObj.sum>0?rptMrrReal/rptMrrObj.sum:0;b+='üìä % CONSECUCI√ìN MRR: '+Math.round(consec*100)+'% ('+f(rptMrrReal,'eurInt')+' / '+f(rptMrrObj.sum,'eurInt')+')\n';}
  b+='\n';
  AE_TEAMS.forEach(team=>{const prefix='ae_'+team.id+'_';const active=filterActive(team.members);const avgA=active.length?(active.reduce((s,m)=>s+m.avg_act,0)/active.length).toFixed(1):'‚Äî';const aesV=gv(prefix+'aes_activos',mi),sqlsPV=gv(prefix+'sqls_persona',mi);const teamProj=(aesV!=null&&sqlsPV!=null)?Math.round(aesV*sqlsPV):null;const tAct=TEAM_ACT[team.id];const tMrrObj=gv(prefix+'mrr_obj',mi);const tMrrReal=gv(prefix+'mrr_real',mi);const tConsec=tMrrObj!=null&&tMrrReal!=null&&tMrrObj>0?Math.round(tMrrReal/tMrrObj*100):null;
    b+='  '+team.houseName+' ('+team.name+')\n';
    b+='    AEs: '+(aesV||'‚Äî')+' ¬∑ SQLs/pers: '+(sqlsPV||'‚Äî')+' ¬∑ Proy: '+(teamProj||'‚Äî')+'\n';
    b+='    MRR Obj: '+(tMrrObj!=null?f(tMrrObj,'eurInt'):'‚Äî')+' ¬∑ MRR Real: '+(tMrrReal!=null?f(tMrrReal,'eurInt'):'‚Äî')+(tConsec!=null?' ¬∑ Consec: '+tConsec+'%':'')+'\n';
    b+='    Actividad: '+avgA+' act/SQL';if(tAct){const p=tAct.hist>0?((tAct.month/tAct.hist)-1):0;b+=' (hist:'+tAct.hist+' mes:'+tAct.month+' '+(p>=0?'+':'')+Math.round(p*100)+'%)';}b+='\n';
    b+='    SQLs real: '+(gv(prefix+'sqls',mi)!=null?gv(prefix+'sqls',mi):'‚Äî')+' ¬∑ ARPA: '+(gv(prefix+'arpa',mi)!=null?f(gv(prefix+'arpa',mi),'eur'):'‚Äî')+'\n';
    b+='    Rate In: '+(gv(prefix+'rate_in',mi)!=null?f(gv(prefix+'rate_in',mi),'pct'):'‚Äî')+' ¬∑ Rate Out: '+(gv(prefix+'rate_out',mi)!=null?f(gv(prefix+'rate_out',mi),'pct'):'‚Äî')+'\n\n';
  });
  b+='üìä RESUMEN GENERAL\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
  const mrrInR=gv('direct_mrr',mi),mrrOutR=gv('mrr_out',mi),mrrTR2=(mrrInR!=null&&mrrOutR!=null)?mrrInR+mrrOutR:null;
  b+=rptLine('MRR TOTAL',mrrTR2,MA.direct_mrr[mi],'eurInt');
  b+=rptLine('MRR Inbound',mrrInR,MI.direct_mrr[mi],'eurInt');
  b+=rptLine('MRR Outbound',mrrOutR,MO.new_mrr_out[mi],'eurInt');
  b+='\n  Sem√°foro:\n';
  const sTR2=(gv('sqls_paid',mi)!=null&&gv('sqls_inbound',mi)!=null&&gv('sqls_out',mi)!=null)?(gv('sqls_paid',mi)+gv('sqls_inbound',mi)+gv('sqls_out',mi)):null;const sTM2=MI.sqls_paid[mi]+MI.sqls_inbound[mi]+MO.sqls_out[mi];const sTD2=sTR2?sTR2-sTM2:null;
  b+=rptSitLine('Oportunidades',sTR2,sTD2,sTD2?sTD2/sTM2:null,'int');
  const gArpa=gv('ae_arpa',mi),gArpaD=gArpa?gArpa-MA.arpa[mi]:null;
  b+=rptSitLine('Precio (ARPA)',gArpa,gArpaD,gArpaD?gArpaD/MA.arpa[mi]:null,'eur');
  const mTD2=mrrTR2?mrrTR2-MA.direct_mrr[mi]:null;
  b+=rptSitLine('Cierre (MRR)',mrrTR2,mTD2,mTD2?mTD2/MA.direct_mrr[mi]:null,'eurInt');
  b+='\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
  b+='Revenue Control Panel ¬∑ '+new Date().toLocaleString('es-ES')+'\n';
  window.open('mailto:?subject='+encodeURIComponent('[Revenue] Reporte Semanal ‚Äî '+MONTHS[mi])+'&body='+encodeURIComponent(b));toast('Reporte generado');
}
checkLogin();load();initSelect();
/* Cargar snapshots y luego render + auto-snapshot */
loadSnapshots(()=>{render();setTimeout(checkAutoSnapshot,3000);});

/* === POPUP T√çA WHATSAPP === */
const TIA_FRASES=[
  "Cada d√≠a es una nueva oportunidad para cerrar deals y ser FELIZ üå∏",
  "No importa cu√°ntos leads se caigan... ¬°T√ö SIEMPRE TE LEVANTAS! üí™‚ú®",
  "Que BONITO es trabajar con gente que te QUIERE y te APOYA ü•∞",
  "Recuerda: el MRR m√°s importante es el que llevas en el CORAZ√ìN üíñ",
  "Hoy va a ser un GRAN D√çA para superar objetivos... ¬°YO LO S√â! üåü",
  "Las mejores VENTAS nacen de una SONRISA sincera üòäüíï",
  "T√∫ no necesitas suerte... ¬°necesitas CAF√â y ACTITUD! ‚òïüî•",
  "Que nadie te diga que no puedes... ¬°el pipeline est√° LLENO de posibilidades! üåà",
  "Respira, sonr√≠e y cierra ese deal como el CAMPE√ìN que eres üèÜ",
  "El que MADRUGA... tiene m√°s tiempo para hacer follow-ups üòÇüíñ",
  "No cuentes los SQLs... ¬°haz que los SQLs CUENTEN! ‚ú®",
  "Eres m√°s fuerte que cualquier churn rate üí™üå∏",
  "La vida es como un funnel: a veces se estrecha pero al final CONVIERTE üéØüíï",
  "Hoy es VIERNES en tu coraz√≥n aunque sea MARTES en el calendario ü•≥",
  "Trabaja DURO, s√© HUMILDE y cierra como si no hubiera MA√ëANA üöÄüíñ",
  "¬øSabes qu√© es mejor que un lead caliente? ¬°T√ö, siendo INCRE√çBLE! üî•üåü"
];
function showTiaPopup(){
  if(document.querySelector('.tia-overlay'))return;
  const frase=TIA_FRASES[Math.floor(Math.random()*TIA_FRASES.length)];
  const overlay=document.createElement('div');
  overlay.className='tia-overlay';
  overlay.innerHTML=`
    <div class="tia-popup">
      <button class="tia-close" onclick="closeTiaPopup()" title="Cerrar">‚úï</button>
      <div class="tia-popup-header"><span class="tia-fwd">Reenviado muchas veces</span></div>
      <div class="tia-img-container">
        <div class="tia-hearts">üíñ üíó üíñ üíó üíñ</div>
        <div class="tia-bunnies">üê∞üíïüê∞</div>
      </div>
      <div class="tia-frase">${frase}</div>
      <div class="tia-sparkles">‚ú®üå∏üí´ü¶ãüå∫‚ú®</div>
      <div class="tia-firma">‚Äî Tu t√≠a que te quiere mucho üíå<br>y tambi√©n tu Revenue Control Panel üè¥‚Äç‚ò†Ô∏è</div>
      <button class="tia-btn" onclick="closeTiaPopup()">¬°Gracias t√≠a! üíñ</button>
    </div>`;
  document.body.appendChild(overlay);
  requestAnimationFrame(()=>requestAnimationFrame(()=>overlay.classList.add('show')));
  overlay.addEventListener('click',e=>{if(e.target===overlay)closeTiaPopup();});
}
function closeTiaPopup(){const o=document.querySelector('.tia-overlay');if(o){o.classList.remove('show');setTimeout(()=>o.remove(),500);}}
/* Mostrar a los 15 segundos de cargar */
setTimeout(showTiaPopup,15000);

/* === DETECTOR DE INACTIVIDAD ‚Äî 3 min sin tocar = frase de t√≠a === */
let _tiaIdleTimer=null;
function resetTiaIdle(){
  clearTimeout(_tiaIdleTimer);
  _tiaIdleTimer=setTimeout(()=>{
    if(!document.querySelector('.tia-overlay'))showTiaPopup();
  },3*60*1000);
}
['mousemove','mousedown','keydown','touchstart','scroll','input','change'].forEach(ev=>{
  document.addEventListener(ev,resetTiaIdle,{passive:true});
});
resetTiaIdle();
</script>
</body>
</html>